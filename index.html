<!DOCTYPE html>
<html lang="fa" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å ÿ±ÿß€å⁄ØÿßŸÜ ÿ±ÿß€å⁄ØÿßŸÜ</title>
    <!-- Favicon (using an emoji as SVG data URI) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéÆ</text></svg>">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vazirmatn Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            direction: rtl; /* ÿ®ÿ±ÿß€å Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿßÿ≤ ÿ≤ÿ®ÿßŸÜ ŸÅÿßÿ±ÿ≥€å */
            text-align: right; /* ÿ™ÿ±ÿßÿ≤ ŸÖÿ™ŸÜ ÿ®Ÿá ÿ±ÿßÿ≥ÿ™ */
        }
        /* Dark Mode Styles (default) */
        .dark {
            background: linear-gradient(to bottom right, #1a202c, #2d3748); /* Darker gradient */
            color: #e2e8f0; /* Light text */
        }
        .dark .bg-gray-700 {
            background-color: #4a5568; /* Darker card background */
        }
        .dark .text-gray-400 {
            color: #a0aec0;
        }
        .dark .text-gray-300 {
            color: #cbd5e0;
        }
        .dark .border-gray-600 {
            border-color: #4a5568;
        }
        .dark .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }

        /* Light Mode Styles */
        html.light {
            background: linear-gradient(to bottom right, #f7fafc, #edf2f7); /* Lighter gradient */
            color: #2d3748; /* Dark text */
        }
        html.light .bg-gray-700 {
            background-color: #ffffff; /* White card background */
            border: 1px solid #e2e8f0;
        }
        html.light .text-gray-400 {
            color: #4a5568;
        }
        html.light .text-gray-300 {
            color: #2d3748;
        }
        html.light .border-gray-600 {
            border-color: #e2e8f0;
        }
        html.light .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        html.light .text-white {
            color: #1a202c;
        }
        html.light .bg-clip-text {
            background-image: linear-gradient(to right, #007bff, #6f42c1); /* Adjust gradient for light mode */
        }

        /* Common card styles */
        .game-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex; /* Ensures content fills height */
            flex-direction: column; /* Stacks content vertically */
            cursor: pointer; /* Indicate clickable */
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        .game-card img {
            object-fit: cover; /* Ensures images cover the area without distortion */
            height: 192px; /* Default h-48 */
        }
        .game-card .p-4 {
            flex-grow: 1; /* Allows content area to expand */
            display: flex;
            flex-direction: column;
        }
        /* Default text truncation */
        .game-card .description-text {
            flex-grow: 1;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 4; /* Default to 4 lines */
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
        }

        /* Custom styles for the theme toggle button */
        #theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .dark #theme-toggle {
            background-color: #4a5568;
            color: #f7fafc;
        }
        html.light #theme-toggle {
            background-color: #fff;
            color: #2d3748;
        }
        #theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Scroll buttons */
        .scroll-button {
            position: fixed;
            right: 20px;
            background-color: #3182ce; /* Blue-600 */
            color: white;
            padding: 12px;
            border-radius: 9999px; /* Full rounded */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            z-index: 90;
            transition: opacity 0.3s, transform 0.3s;
            opacity: 0; /* Hidden by default */
            transform: scale(0.9);
        }
        .scroll-button:hover {
            background-color: #2b6cb0; /* Blue-700 */
            transform: scale(1);
        }
        .scroll-button.show {
            opacity: 1;
            transform: scale(1);
        }
        #scroll-to-top {
            bottom: 80px;
        }
        #scroll-to-bottom {
            bottom: 20px;
        }

        /* Responsive layout adjustments based on selected columns */
        /* For 1 column (Large View) */
        .layout-cols-1 .game-card img { height: 320px; /* h-80 */ }
        .layout-cols-1 .game-card h2 { font-size: 2rem; /* text-4xl */ }
        .layout-cols-1 .game-card .description-text { -webkit-line-clamp: 8; }
        .layout-cols-1 .game-card .text-sm { font-size: 1rem; /* text-base */ }

        /* For 2 columns (Medium View) */
        .layout-cols-2 .game-card img { height: 256px; /* h-64 */ }
        .layout-cols-2 .game-card h2 { font-size: 1.75rem; /* text-3xl */ }
        .layout-cols-2 .game-card .description-text { -webkit-line-clamp: 6; }
        .layout-cols-2 .game-card .text-sm { font-size: 0.875rem; /* text-sm */ }

        /* For 3 columns (Small View - Default) */
        .layout-cols-3 .game-card img { height: 192px; /* h-48 */ }
        .layout-cols-3 .game-card h2 { font-size: 1.25rem; /* text-xl */ }
        .layout-cols-3 .game-card .description-text { -webkit-line-clamp: 4; }
        .layout-cols-3 .game-card .text-sm { font-size: 0.875rem; /* text-sm */ }

        /* For 4 columns (Very Small View) */
        .layout-cols-4 .game-card img { height: 160px; /* h-40 */ }
        .layout-cols-4 .game-card h2 { font-size: 1rem; /* text-lg */ }
        .layout-cols-4 .game-card .description-text { -webkit-line-clamp: 3; }
        .layout-cols-4 .game-card .text-sm { font-size: 0.75rem; /* text-xs */ }

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background-color: #4a5568; /* Darker card background */
            margin: auto;
            padding: 20px;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.2), 0 4px 6px -2px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
            position: relative;
            max-height: 90vh; /* Limit height */
            overflow-y: auto; /* Enable scrolling within modal content */
            color: #e2e8f0;
        }
        html.light .modal-content {
            background-color: #ffffff; /* White card background */
            color: #2d3748;
        }
        html.light .modal-content h2 {
            color: #1a202c;
        }
        html.light .modal-content p {
            color: #4a5568;
        }
        .modal-content h2 {
            font-size: 1.75rem; /* text-3xl */
            font-weight: bold;
            margin-bottom: 1rem;
            color: #fff;
        }
        .modal-content p {
            margin-bottom: 0.5rem;
            color: #cbd5e0;
        }
        .modal-content img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #fff;
            text-decoration: none;
            cursor: pointer;
        }
        html.light .close-button {
             color: #4a5568;
        }
        html.light .close-button:hover,
        html.light .close-button:focus {
            color: #1a202c;
        }
        /* Style for full description within modal */
        .full-description-text {
            white-space: pre-wrap; /* Preserves whitespace and line breaks */
            word-wrap: break-word; /* Breaks long words */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-gray-100 min-h-screen p-4 sm:p-8">
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" class="bg-gray-700 text-white rounded-full p-2">
        ‚òÄÔ∏è
    </button>

    <div class="container mx-auto max-w-7xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-4">
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-600">
                    ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å ÿ±ÿß€å⁄ØÿßŸÜ ÿßŸÖÿ±Ÿàÿ≤
                </span>
            </h1>
            <p class="text-lg sm:text-xl text-gray-300">
                ÿ¨ÿØ€åÿØÿ™ÿ±€åŸÜ ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å ÿ±ÿß€å⁄ØÿßŸÜ ÿßÿ≤ ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß€å ŸÖÿÆÿ™ŸÑŸÅ ÿ±ÿß ÿß€åŸÜÿ¨ÿß Ÿæ€åÿØÿß ⁄©ŸÜ€åÿØ!
            </p>
        </header>

        <!-- Filter and Layout Options -->
        <div class="mb-8 flex flex-col sm:flex-row items-center justify-center gap-4">
            <!-- Store Filter -->
            <label for="store-filter" class="text-lg font-medium text-gray-300 whitespace-nowrap">
                ŸÅ€åŸÑÿ™ÿ± ÿ®ÿ± ÿßÿ≥ÿßÿ≥ ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá:
            </label>
            <select id="store-filter" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="all">ŸáŸÖŸá ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß</option>
                <!-- Options will be populated by JavaScript -->
            </select>

            <!-- Content Type Filter -->
            <label for="content-type-filter" class="text-lg font-medium text-gray-300 whitespace-nowrap">
                ŸÜŸàÿπ ŸÖÿ≠ÿ™Ÿàÿß:
            </label>
            <select id="content-type-filter" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="all-content">ŸáŸÖŸá (ÿ®ÿßÿ≤€å Ÿà ÿßŸÅÿ≤ŸàŸÜŸá)</option>
                <option value="games-only">ŸÅŸÇÿ∑ ÿ®ÿßÿ≤€å</option>
                <option value="dlc-only">ŸÅŸÇÿ∑ DLC Ÿà ÿßŸÅÿ≤ŸàŸÜŸá</option>
            </select>

            <!-- Price Type Filter -->
            <label for="price-type-filter" class="text-lg font-medium text-gray-300 whitespace-nowrap">
                ŸÜŸàÿπ ŸÇ€åŸÖÿ™:
            </label>
            <select id="price-type-filter" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="all-prices">ŸáŸÖŸá (ÿ±ÿß€å⁄ØÿßŸÜ Ÿà ÿ™ÿÆŸÅ€åŸÅ)</option>
                <option value="free-only">ŸÅŸÇÿ∑ ÿ±ÿß€å⁄ØÿßŸÜ</option>
                <option value="discounted-only">ŸÅŸÇÿ∑ ÿ™ÿÆŸÅ€åŸÅ‚ÄåÿÆŸàÿ±ÿØŸá</option>
            </select>

            <!-- Column Selector -->
            <label for="column-selector" class="text-lg font-medium text-gray-300 whitespace-nowrap sm:mr-4">
                ÿ™ÿπÿØÿßÿØ ÿ≥ÿ™ŸàŸÜ‚ÄåŸáÿß:
            </label>
            <select id="column-selector" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="1">€± ÿ≥ÿ™ŸàŸÜ (ÿ®ÿ≤ÿ±⁄Ø)</option>
                <option value="2">€≤ ÿ≥ÿ™ŸàŸÜ (ŸÖÿ™Ÿàÿ≥ÿ∑)</option>
                <option value="3">€≥ ÿ≥ÿ™ŸàŸÜ (⁄©Ÿà⁄Ü⁄©)</option>
                <option value="4">€¥ ÿ≥ÿ™ŸàŸÜ (ÿÆ€åŸÑ€å ⁄©Ÿà⁄Ü⁄©)</option>
            </select>
        </div>

        <div id="loading" class="text-center text-xl text-blue-400 mb-8">
            ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ®ÿßÿ≤€å‚ÄåŸáÿß...
        </div>

        <div id="error-message" class="hidden text-center text-xl text-red-400 mb-8">
            ÿÆÿ∑ÿß ÿØÿ± ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ÿ®ÿßÿ≤€å‚ÄåŸáÿß. ŸÑÿ∑ŸÅÿßŸã ÿ®ÿπÿØÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿßŸÖÿ™ÿ≠ÿßŸÜ ⁄©ŸÜ€åÿØ.
        </div>

        <div id="no-games-message" class="hidden text-center text-xl text-gray-400 mb-8">
            ÿØÿ± ÿ≠ÿßŸÑ ÿ≠ÿßÿ∂ÿ± Ÿá€å⁄Ü ÿ®ÿßÿ≤€å ÿ±ÿß€å⁄ØÿßŸÜ€å ÿ®ÿ±ÿß€å ŸÜŸÖÿß€åÿ¥ Ÿàÿ¨ŸàÿØ ŸÜÿØÿßÿ±ÿØ.
        </div>

        <!-- games-container will dynamically get grid-cols and layout-cols classes -->
        <div id="games-container" class="grid gap-6"> 
            <!-- Game cards will be injected here by JavaScript -->
        </div>
    </div>

    <!-- Modal for Full Game Details -->
    <div id="game-detail-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <img id="modal-image" src="" alt="ÿ™ÿµŸà€åÿ± ÿ®ÿßÿ≤€å" class="mb-4 rounded-lg">
            <h2 id="modal-title" class="text-white text-3xl mb-2"></h2>
            <p id="modal-store-info" class="text-gray-400 mb-3"></p>
            <p id="modal-discount-info" class="text-gray-400 mb-3"></p>
            <p id="modal-description" class="text-gray-300 mb-4 full-description-text"></p>
            <div class="space-y-1">
                <p id="modal-metacritic-score" class="text-sm text-gray-300"></p>
                <p id="modal-metacritic-userscore" class="text-sm text-gray-300"></p>
                <p id="modal-steam-overall-score" class="text-sm text-gray-300"></p>
                <p id="modal-steam-recent-score" class="text-sm text-gray-300"></p>
                <p id="modal-genres" class="text-sm text-gray-300"></p>
                <p id="modal-player-info" class="text-sm text-gray-300"></p>
                <p id="modal-age-rating" class="text-sm text-gray-300"></p>
                <a id="modal-trailer-link" href="#" target="_blank" class="text-blue-400 hover:underline text-sm mt-2 block hidden"><i class="fas fa-film"></i> ŸÖÿ¥ÿßŸáÿØŸá ÿ™ÿ±€åŸÑÿ±</a>
                <a id="modal-game-link" href="#" target="_blank" class="mt-4 block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                    ÿØÿ±€åÿßŸÅÿ™ ÿ®ÿßÿ≤€å
                </a>
            </div>
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <button id="scroll-to-top" class="scroll-button">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Scroll to Bottom Button -->
    <button id="scroll-to-bottom" class="scroll-button">
        <i class="fas fa-arrow-down"></i>
    </button>

    <script>
        let allGames = []; // To store all fetched games
        const gamesContainer = document.getElementById('games-container');
        const loadingMessage = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const noGamesMessage = document.getElementById('no-games-message');
        const storeFilter = document.getElementById('store-filter');
        const columnSelector = document.getElementById('column-selector'); // Column selector
        const themeToggle = document.getElementById('theme-toggle');
        const scrollToTopBtn = document.getElementById('scroll-to-top');
        const scrollToBottomBtn = document.getElementById('scroll-to-bottom');
        
        // New filter elements
        const contentTypeFilter = document.getElementById('content-type-filter'); 
        const priceTypeFilter = document.getElementById('price-type-filter'); 

        // Modal elements
        const gameDetailModal = document.getElementById('game-detail-modal');
        const modalImage = document.getElementById('modal-image');
        const modalTitle = document.getElementById('modal-title');
        const modalStoreInfo = document.getElementById('modal-store-info');
        const modalDiscountInfo = document.getElementById('modal-discount-info');
        const modalDescription = document.getElementById('modal-description');
        const modalMetacriticScore = document.getElementById('modal-metacritic-score');
        const modalMetacriticUserScore = document.getElementById('modal-metacritic-userscore');
        const modalSteamOverallScore = document.getElementById('modal-steam-overall-score');
        const modalSteamRecentScore = document.getElementById('modal-steam-recent-score');
        const modalGenres = document.getElementById('modal-genres');
        const modalPlayerInfo = document.getElementById('modal-player-info');
        const modalAgeRating = document.getElementById('modal-age-rating');
        const modalTrailerLink = document.getElementById('modal-trailer-link');
        const modalGameLink = document.getElementById('modal-game-link');


        // ŸÜ⁄Øÿßÿ¥ÿ™ ŸÜÿßŸÖ‚ÄåŸáÿß€å ÿßŸÜ⁄ØŸÑ€åÿ≥€å ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß ÿ®Ÿá ŸÜÿßŸÖ‚ÄåŸáÿß€å ŸÅÿßÿ±ÿ≥€å ÿ®ÿ±ÿß€å ŸÜŸÖÿß€åÿ¥
        const storeDisplayMap = {
            "epicgames": "ÿßŸæ€å⁄© ⁄Ø€åŸÖÿ≤", 
            "steam": "ÿßÿ≥ÿ™€åŸÖ",
            "googleplay": "ÿßŸÜÿØÿ±Ÿà€åÿØ",
            "epicgames(android)": "ÿßŸÜÿØÿ±Ÿà€åÿØ",
            "epicgames(ios)": "ÿ¢€å‚ÄåÿßŸàÿßÿ≥", 
            "iosappstore": "ÿ¢€å‚ÄåÿßŸàÿßÿ≥", 
            "playstation": "ŸæŸÑ€å‚Äåÿßÿ≥ÿ™€åÿ¥ŸÜ",
            "xbox": "ÿß€å⁄©ÿ≥‚Äåÿ®ÿß⁄©ÿ≥",
            "gog": "GOG",
            "itch.io": "Itch.io",
            "indiegala": "ÿß€åŸÜÿØ€å‚Äå⁄ØÿßŸÑÿß",
            "stove": "STOVE",
            "other": "ÿ≥ÿß€åÿ± ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß",
            "reddit": "ÿ±ÿØ€åÿ™ (ŸÑ€åŸÜ⁄© ŸÖÿ≥ÿ™ŸÇ€åŸÖ)",
            "android": "ÿßŸÜÿØÿ±Ÿà€åÿØ",
            "ios": "ÿ¢€å‚ÄåÿßŸàÿßÿ≥", 
            "microsoftstore": "ŸÖÿß€å⁄©ÿ±Ÿàÿ≥ÿßŸÅÿ™ ÿßÿ≥ÿ™Ÿàÿ±",
            "humblestore": "ŸáÿßŸÖÿ®ŸÑ ÿßÿ≥ÿ™Ÿàÿ±",
            "fanatical": "ŸÅŸÜÿßÿ™€å⁄©ÿßŸÑ",
            "greenmangaming": "⁄Øÿ±€åŸÜ ŸÖŸÜ ⁄Ø€åŸÖ€åŸÜ⁄Ø",
            "amazon": "ÿ¢ŸÖÿßÿ≤ŸàŸÜ",
            "blizzard": "ÿ®ŸÑ€åÿ≤ÿßÿ±ÿØ",
            "eastore": "EA ÿßÿ≥ÿ™Ÿàÿ±",
            "ubisoftstore": "€åŸàÿ®€å‚Äåÿ≥ÿßŸÅÿ™ ÿßÿ≥ÿ™Ÿàÿ±"
        };

        // ÿ™ÿ±ÿ™€åÿ® ŸÜŸÖÿß€åÿ¥ ÿØŸÑÿÆŸàÿßŸá ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß (ÿ®ÿ± ÿßÿ≥ÿßÿ≥ ŸÜÿßŸÖ‚ÄåŸáÿß€å ŸÅÿßÿ±ÿ≥€å)
        const storeDisplayOrder = [
            "ŸáŸÖŸá ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß", 
            "ÿßÿ≥ÿ™€åŸÖ",
            "ÿßŸæ€å⁄© ⁄Ø€åŸÖÿ≤", 
            "ÿßŸÜÿØÿ±Ÿà€åÿØ",
            "ÿ¢€å‚ÄåÿßŸàÿßÿ≥", 
            "ŸæŸÑ€å‚Äåÿßÿ≥ÿ™€åÿ¥ŸÜ",
            "ÿß€å⁄©ÿ≥‚Äåÿ®ÿß⁄©ÿ≥",
            "GOG",
            "Itch.io",
            "ÿß€åŸÜÿØ€å‚Äå⁄ØÿßŸÑÿß",
            "STOVE",
            "ŸÖÿß€å⁄©ÿ±Ÿàÿ≥ÿßŸÅÿ™ ÿßÿ≥ÿ™Ÿàÿ±",
            "ŸáÿßŸÖÿ®ŸÑ ÿßÿ≥ÿ™Ÿàÿ±",
            "ŸÅŸÜÿßÿ™€å⁄©ÿßŸÑ",
            "⁄Øÿ±€åŸÜ ŸÖŸÜ ⁄Ø€åŸÖ€åŸÜ⁄Ø",
            "ÿ¢ŸÖÿßÿ≤ŸàŸÜ",
            "ÿ®ŸÑ€åÿ≤ÿßÿ±ÿØ",
            "EA ÿßÿ≥ÿ™Ÿàÿ±",
            "€åŸàÿ®€å‚Äåÿ≥ÿßŸÅÿ™ ÿßÿ≥ÿ™Ÿàÿ±",
            "ÿ±ÿØ€åÿ™ (ŸÑ€åŸÜ⁄© ŸÖÿ≥ÿ™ŸÇ€åŸÖ)",
            "ÿ≥ÿß€åÿ± ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß"
        ];

        // ŸÜ⁄Øÿßÿ¥ÿ™ ŸÜÿßŸÖ‚ÄåŸáÿß€å ÿßŸÜ⁄ØŸÑ€åÿ≥€å ⁄òÿßŸÜÿ±Ÿáÿß ÿ®Ÿá ŸÜÿßŸÖ‚ÄåŸáÿß€å ŸÅÿßÿ±ÿ≥€å
        const genreDisplayMap = {
            "action": "ÿß⁄©ÿ¥ŸÜ", "adventure": "ŸÖÿßÿ¨ÿ±ÿßÿ¨Ÿà€å€å", "rpg": "ŸÜŸÇÿ¥‚Äåÿ¢ŸÅÿ±€åŸÜ€å", "strategy": "ÿßÿ≥ÿ™ÿ±ÿßÿ™⁄ò€å", 
            "simulation": "ÿ¥ÿ®€åŸá‚Äåÿ≥ÿßÿ≤€å", "sports": "Ÿàÿ±ÿ≤ÿ¥€å", "puzzle": "Ÿæÿßÿ≤ŸÑ", "indie": "ÿß€åŸÜÿØ€å", 
            "casual": "⁄©⁄òŸàÿßŸÑ", "racing": "ŸÖÿ≥ÿßÿ®ŸÇŸá‚Äåÿß€å", "fighting": "ŸÖÿ®ÿßÿ±ÿ≤Ÿá‚Äåÿß€å", "horror": "ÿ™ÿ±ÿ≥ŸÜÿß⁄©", 
            "survival": "ÿ®ŸÇÿß", "shooter": "ÿ¥Ÿàÿ™ÿ±", "massively multiplayer": "⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá ÿ¢ŸÜŸÑÿß€åŸÜ ⁄Øÿ≥ÿ™ÿ±ÿØŸá", 
            "early access": "ÿØÿ≥ÿ™ÿ±ÿ≥€å ÿ≤ŸàÿØŸáŸÜ⁄ØÿßŸÖ", "free to play": "ÿ±ÿß€å⁄ØÿßŸÜ", "arcade": "ÿ¢ÿ±⁄©€åÿØ", 
            "platformer": "ŸæŸÑÿ™ŸÅÿ±ŸÖÿ±", "rhythm": "ÿ±€åÿ™ŸÖ€å⁄©", "educational": "ÿ¢ŸÖŸàÿ≤ÿ¥€å", "family": "ÿÆÿßŸÜŸàÿßÿØ⁄Ø€å", 
            "music": "ŸÖŸàÿ≥€åŸÇ€å", "board game": "ÿ®ÿßÿ≤€å ÿ±ŸàŸÖ€åÿ≤€å", "card game": "ÿ®ÿßÿ≤€å ⁄©ÿßÿ±ÿ™€å", 
            "visual novel": "ÿ±ŸÖÿßŸÜ ÿ™ÿµŸà€åÿ±€å", "point & click": "ÿßÿ¥ÿßÿ±Ÿá Ÿà ⁄©ŸÑ€å⁄©", "turn-based": "ŸÜŸàÿ®ÿ™€å", 
            "real-time strategy": "ÿßÿ≥ÿ™ÿ±ÿßÿ™⁄ò€å ŸáŸÖ‚Äåÿ≤ŸÖÿßŸÜ", "tower defense": "ÿØŸÅÿßÿπ ÿßÿ≤ ÿ®ÿ±ÿ¨", "role-playing": "ŸÜŸÇÿ¥‚Äåÿ¢ŸÅÿ±€åŸÜ€å", 
            "open world": "ÿ¨ŸáÿßŸÜ ÿ®ÿßÿ≤", "sandbox": "ÿ≥ŸÜÿØÿ®ÿß⁄©ÿ≥", "stealth": "ŸÖÿÆŸÅ€å‚Äå⁄©ÿßÿ±€å", "puzzle-platformer": "ŸæŸÑÿ™ŸÅÿ±ŸÖÿ± Ÿæÿßÿ≤ŸÑ€å", 
            "metroidvania": "ŸÖÿ™ÿ±Ÿà€åÿØŸàÿßŸÜ€åÿß", "roguelike": "ÿ±Ÿà⁄Ø‚ÄåŸÑÿß€å⁄©", "rogue-lite": "ÿ±Ÿà⁄Ø‚ÄåŸÑÿß€åÿ™", 
            "city-builder": "ÿ¥Ÿáÿ±ÿ≥ÿßÿ≤€å", "grand strategy": "ÿßÿ≥ÿ™ÿ±ÿßÿ™⁄ò€å ÿ®ÿ≤ÿ±⁄Ø", "wargame": "ÿ®ÿßÿ≤€å ÿ¨ŸÜ⁄Ø€å", 
            "historical": "ÿ™ÿßÿ±€åÿÆ€å", "fantasy": "ŸÅÿßŸÜÿ™ÿ≤€å", "sci-fi": "ÿπŸÑŸÖ€å ÿ™ÿÆ€åŸÑ€å", "cyberpunk": "ÿ≥ÿß€åÿ®ÿ±ŸæÿßŸÜ⁄©", 
            "post-apocalyptic": "Ÿæÿ≥ÿßÿ¢ÿÆÿ±ÿßŸÑÿ≤ŸÖÿßŸÜ€å", "superhero": "ÿßÿ®ÿ±ŸÇŸáÿ±ŸÖÿßŸÜ€å", "anime": "ÿßŸÜ€åŸÖŸá", 
            "pixel graphics": "⁄Øÿ±ÿßŸÅ€å⁄© Ÿæ€å⁄©ÿ≥ŸÑ€å", "2d": "ÿØŸàÿ®ÿπÿØ€å", "3d": "ÿ≥Ÿá‚Äåÿ®ÿπÿØ€å", "vr": "ŸàÿßŸÇÿπ€åÿ™ ŸÖÿ¨ÿßÿ≤€å", 
            "co-op": "ŸáŸÖ⁄©ÿßÿ±€å", "multiplayer": "⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá", "singleplayer": "ÿ™⁄©‚ÄåŸÜŸÅÿ±Ÿá", 
            "online multi-player": "⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá ÿ¢ŸÜŸÑÿß€åŸÜ", "local multi-player": "⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá ŸÖÿ≠ŸÑ€å", "online co-op": "ŸáŸÖ⁄©ÿßÿ±€å ÿ¢ŸÜŸÑÿß€åŸÜ", 
            "local co-op": "ŸáŸÖ⁄©ÿßÿ±€å ŸÖÿ≠ŸÑ€å", "controller support": "Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿßÿ≤ ⁄©ŸÜÿ™ÿ±ŸÑÿ±", "full controller support": "Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ⁄©ÿßŸÖŸÑ ÿßÿ≤ ⁄©ŸÜÿ™ÿ±ŸÑÿ±", 
            "partial controller support": "Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ÿ¨ÿ≤ÿ¶€å ÿßÿ≤ ⁄©ŸÜÿ™ÿ±ŸÑÿ±", "steam achievements": "ÿØÿ≥ÿ™ÿßŸàÿ±ÿØŸáÿß", 
            "steam trading cards": "⁄©ÿßÿ±ÿ™‚ÄåŸáÿß€å ÿ™ÿ¨ÿßÿ±€å ÿßÿ≥ÿ™€åŸÖ", "steam cloud": "ÿ∞ÿÆ€åÿ±Ÿá ÿßÿ®ÿ±€å ÿßÿ≥ÿ™€åŸÖ", "steam workshop": "⁄©ÿßÿ±⁄ØÿßŸá ÿßÿ≥ÿ™€åŸÖ", 
            "in-app purchases": "ÿÆÿ±€åÿØ ÿØÿ±ŸàŸÜ ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿß€å", "rts": "ÿßÿ≥ÿ™ÿ±ÿßÿ™⁄ò€å ŸáŸÖ‚Äåÿ≤ŸÖÿßŸÜ (RTS)", "fps": "ÿ¥Ÿàÿ™ÿ± ÿßŸàŸÑ ÿ¥ÿÆÿµ (FPS)", 
            "tps": "ÿ¥Ÿàÿ™ÿ± ÿ≥ŸàŸÖ ÿ¥ÿÆÿµ (TPS)", "moba": "ŸÖ€åÿØÿßŸÜ ŸÜÿ®ÿ±ÿØ ÿ¢ŸÜŸÑÿß€åŸÜ ⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá (MOBA)", "mmorpg": "ŸÜŸÇÿ¥‚Äåÿ¢ŸÅÿ±€åŸÜ€å ÿ¢ŸÜŸÑÿß€åŸÜ ⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá ⁄Øÿ≥ÿ™ÿ±ÿØŸá (MMORPG)", 
            "jrpg": "ŸÜŸÇÿ¥‚Äåÿ¢ŸÅÿ±€åŸÜ€å ⁄òÿßŸæŸÜ€å (JRPG)", "western rpg": "ŸÜŸÇÿ¥‚Äåÿ¢ŸÅÿ±€åŸÜ€å ÿ∫ÿ±ÿ®€å", "dating sim": "ÿ¥ÿ®€åŸá‚Äåÿ≥ÿßÿ≤ ÿØŸàÿ≥ÿ™€åÿßÿ®€å", 
            "farming sim": "ÿ¥ÿ®€åŸá‚Äåÿ≥ÿßÿ≤ ⁄©ÿ¥ÿßŸàÿ±ÿ≤€å", "life sim": "ÿ¥ÿ®€åŸá‚Äåÿ≥ÿßÿ≤ ÿ≤ŸÜÿØ⁄Ø€å", "tycoon": "ÿ™ÿß€å⁄ØŸàŸÜ", 
            "management": "ŸÖÿØ€åÿ±€åÿ™", "building": "ÿ≥ÿßÿÆÿ™ Ÿà ÿ≥ÿßÿ≤", "crafting": "ÿ≥ÿßÿÆÿ™ Ÿà ÿ≥ÿßÿ≤", 
            "survival horror": "Ÿàÿ≠ÿ¥ÿ™ ÿ®ŸÇÿß", "psychological horror": "Ÿàÿ≠ÿ¥ÿ™ ÿ±ŸàÿßŸÜ‚Äåÿ¥ŸÜÿßÿÆÿ™€å", "action rpg": "ŸÜŸÇÿ¥‚Äåÿ¢ŸÅÿ±€åŸÜ€å ÿß⁄©ÿ¥ŸÜ", 
            "adventure rpg": "ŸÜŸÇÿ¥‚Äåÿ¢ŸÅÿ±€åŸÜ€å ŸÖÿßÿ¨ÿ±ÿßÿ¨Ÿà€å€å", "puzzle adventure": "ŸÖÿßÿ¨ÿ±ÿßÿ¨Ÿà€å€å Ÿæÿßÿ≤ŸÑ€å", "hidden object": "ÿßÿ¥€åÿßÿ° ŸæŸÜŸáÿßŸÜ", 
            "match 3": "ÿ¨Ÿàÿ±⁄Ü€åŸÜ €≥", "card battle": "ŸÜÿ®ÿ±ÿØ ⁄©ÿßÿ±ÿ™€å", "deckbuilding": "ÿ≥ÿßÿÆÿ™ ÿπÿ±ÿ¥Ÿá", 
            "tabletop": "ÿ±ŸàŸÖ€åÿ≤€å", "party game": "ÿ®ÿßÿ≤€å ŸÖŸáŸÖÿßŸÜ€å", "trivia": "ÿØÿßŸÜÿ≥ÿ™ŸÜ€å‚ÄåŸáÿß", 
            "dance": "ÿ±ŸÇÿµ", "karaoke": "⁄©ÿßÿ±ÿßÿ¶Ÿà⁄©Ÿá", "exercise": "Ÿàÿ±ÿ≤ÿ¥€å", "fitness": "ÿ™ŸÜÿßÿ≥ÿ® ÿßŸÜÿØÿßŸÖ", 
            "vr exclusive": "ÿßŸÜÿ≠ÿµÿßÿ±€å ŸàÿßŸÇÿπ€åÿ™ ŸÖÿ¨ÿßÿ≤€å", "vr support": "Ÿæÿ¥ÿ™€åÿ®ÿßŸÜ€å ŸàÿßŸÇÿπ€åÿ™ ŸÖÿ¨ÿßÿ≤€å", "room-scale": "ŸÖŸÇ€åÿßÿ≥ ÿßÿ™ÿßŸÇ", 
            "seated": "ŸÜÿ¥ÿ≥ÿ™Ÿá", "standing": "ÿß€åÿ≥ÿ™ÿßÿØŸá", "motion controls": "⁄©ŸÜÿ™ÿ±ŸÑ‚ÄåŸáÿß€å ÿ≠ÿ±⁄©ÿ™€å", 
            "online pvp": "ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ¢ŸÜŸÑÿß€åŸÜ", "local pvp": "ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ ÿ®ÿßÿ≤€å⁄©ŸÜ ŸÖÿ≠ŸÑ€å", 
            "co-op campaign": "⁄©ŸÖŸæ€åŸÜ ŸáŸÖ⁄©ÿßÿ±€å", "pvp": "ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ ÿ®ÿßÿ≤€å⁄©ŸÜ", "online": "ÿ¢ŸÜŸÑÿß€åŸÜ", 
            "offline": "ÿ¢ŸÅŸÑÿß€åŸÜ", "local": "ŸÖÿ≠ŸÑ€å", "controller": "⁄©ŸÜÿ™ÿ±ŸÑÿ±", "keyboard": "⁄©€åÿ®Ÿàÿ±ÿØ", 
            "mouse": "ŸÖŸàÿ≥", "touch": "ŸÑŸÖÿ≥€å", "voxel": "Ÿà⁄©ÿ≥ŸÑ", "hand-drawn": "ŸÜŸÇÿßÿ¥€å ÿØÿ≥ÿ™€å", 
            "stylized": "ÿ≥ÿ®⁄©‚ÄåÿØÿßÿ±", "minimalist": "ŸÖ€åŸÜ€åŸÖÿßŸÑ€åÿ≥ÿ™€å", "abstract": "ÿßŸÜÿ™ÿ≤ÿßÿπ€å", "beautiful": "ÿ≤€åÿ®ÿß", 
            "atmospheric": "ÿ¨Ÿà⁄Ø€åÿ±", "relaxing": "ÿ¢ÿ±ÿßŸÖÿ¥‚Äåÿ®ÿÆÿ¥", "meditation": "ŸÖÿØ€åÿ™€åÿ¥ŸÜ", "comedy": "⁄©ŸÖÿØ€å", 
            "dark comedy": "⁄©ŸÖÿØ€å ÿ≥€åÿßŸá", "satire": "Ÿáÿ¨Ÿà", "political": "ÿ≥€åÿßÿ≥€å", "social commentary": "ŸÜŸÇÿØ ÿßÿ¨ÿ™ŸÖÿßÿπ€å", 
            "dystopian": "ÿØ€åÿ≥ÿ™ŸàŸæ€åÿß€å€å", "utopian": "ÿ¢ÿ±ŸÖÿßŸÜ‚Äåÿ¥Ÿáÿ±€å", "surreal": "ÿ≥Ÿàÿ±ÿ¶ÿßŸÑ", "experimental": "ÿ™ÿ¨ÿ±ÿ®€å", 
            "art game": "ÿ®ÿßÿ≤€å ŸáŸÜÿ±€å", "walking simulator": "ÿ¥ÿ®€åŸá‚Äåÿ≥ÿßÿ≤ Ÿæ€åÿßÿØŸá‚Äåÿ±Ÿà€å"
        };


        // ŸÜ⁄Øÿßÿ¥ÿ™ ÿ±ÿØŸá‚Äåÿ®ŸÜÿØ€å‚ÄåŸáÿß€å ÿ≥ŸÜ€å ÿßŸÜ⁄ØŸÑ€åÿ≥€å ÿ®Ÿá ŸÜÿßŸÖ‚ÄåŸáÿß€å ŸÅÿßÿ±ÿ≥€å
        const ageRatingDisplayMap = {
            "esrb everyone": "ESRB: ŸáŸÖŸá", "esrb everyone 10+": "ESRB: ŸáŸÖŸá €±€∞+", "esrb teen": "ESRB: ŸÜŸàÿ¨ŸàÿßŸÜ", 
            "esrb mature": "ESRB: ÿ®ÿ≤ÿ±⁄Øÿ≥ÿßŸÑ", "esrb adults only": "ESRB: ŸÅŸÇÿ∑ ÿ®ÿ≤ÿ±⁄Øÿ≥ÿßŸÑÿßŸÜ", "pegi 3": "PEGI: €≥+", 
            "pegi 7": "PEGI: €∑+", "pegi 12": "PEGI: €±€≤+", "pegi 16": "PEGI: €±€∂+", "pegi 18": "PEGI: €±€∏+", 
            "cero a": "CERO: A (ŸáŸÖŸá ÿ≥ŸÜ€åŸÜ)", "cero b": "CERO: B (€±€≤+)", "cero c": "CERO: C (€±€µ+)", 
            "cero d": "CERO: D (€±€∑+)", "cero z": "CERO: Z (€±€∏+)", "rating pending": "ÿ±ÿØŸá‚Äåÿ®ŸÜÿØ€å ÿØÿ± ÿØÿ≥ÿ™ ÿ®ÿ±ÿ±ÿ≥€å", 
            "rp": "ÿ±ÿØŸá‚Äåÿ®ŸÜÿØ€å ÿØÿ± ÿØÿ≥ÿ™ ÿ®ÿ±ÿ±ÿ≥€å", "ao": "ŸÅŸÇÿ∑ ÿ®ÿ≤ÿ±⁄Øÿ≥ÿßŸÑÿßŸÜ", "m": "ÿ®ÿßŸÑÿ∫", "t": "ŸÜŸàÿ¨ŸàÿßŸÜ", "e": "ŸáŸÖŸá", 
            "e10+": "ŸáŸÖŸá €±€∞+",
        };


        // Function to set the theme
        function setTheme(isDark) {
            if (isDark) {
                document.documentElement.classList.add('dark');
                document.documentElement.classList.remove('light');
                themeToggle.textContent = '‚òÄÔ∏è'; // Sun icon for light mode toggle
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.add('light');
                document.documentElement.classList.remove('dark');
                themeToggle.textContent = 'üåô'; // Moon icon for dark mode toggle
                localStorage.setItem('theme', 'light');
            }
        }

        // Initialize theme based on local storage or Tehran time
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                setTheme(savedTheme === 'dark');
            } else {
                // Determine theme based on Tehran time
                const now = new Date();
                const tehranTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Tehran' }));
                const hour = tehranTime.getHours();
                // Assume day from 6 AM to 6 PM (18:00)
                const isDayTimeInTehran = hour >= 6 && hour < 18;
                setTheme(!isDayTimeInTehran); // Default to dark if it's night in Tehran
            }
        }

        // Function to apply column layout and sizing
        function applyColumnLayout(columns) {
            // Remove existing grid-cols classes
            gamesContainer.classList.remove('grid-cols-1', 'sm:grid-cols-2', 'lg:grid-cols-3', 'xl:grid-cols-4',
                                         'sm:grid-cols-1', 'sm:grid-cols-2', 'sm:grid-cols-3', 'sm:grid-cols-4',
                                         'lg:grid-cols-1', 'lg:grid-cols-2', 'lg:grid-cols-3', 'lg:grid-cols-4',
                                         'xl:grid-cols-1', 'xl:grid-cols-2', 'xl:grid-cols-3', 'xl:grid-cols-4');
            
            // Add grid-cols for selected number of columns (responsive across all breakpoints)
            gamesContainer.classList.add(`grid-cols-1`, `sm:grid-cols-${columns}`, `lg:grid-cols-${columns}`, `xl:grid-cols-${columns}`);

            // Remove existing layout-cols classes
            gamesContainer.classList.remove('layout-cols-1', 'layout-cols-2', 'layout-cols-3', 'layout-cols-4');
            // Add new layout-cols class
            gamesContainer.classList.add(`layout-cols-${columns}`);

            // Save preference to local storage
            localStorage.setItem('selectedColumns', columns);

            // Re-render games to apply new sizing (though CSS handles most of it)
            applyFilter(); // This will re-render with current filter and new layout
        }

        // Function to sanitize HTML from a string
        function stripHtml(html) {
            let doc = new DOMParser().parseFromString(html, 'text/html');
            return doc.body.textContent || "";
        }

        // Function to render games based on filter
        function renderGames(gamesToRender) {
            gamesContainer.innerHTML = ''; // Clear existing games
            if (gamesToRender.length === 0) {
                noGamesMessage.classList.remove('hidden');
                return;
            } else {
                noGamesMessage.classList.add('hidden');
            }

            gamesToRender.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card bg-gray-700 rounded-xl shadow-lg overflow-hidden flex flex-col transform hover:scale-105 transition duration-300 ease-in-out';
                gameCard.onclick = () => openModal(game); // Add click event to open modal

                // Placeholder image if image_url is missing or broken
                const imageUrl = game.image_url || `https://placehold.co/600x338/374151/D1D5DB?text=${encodeURIComponent(game.title || 'ÿ™ÿµŸà€åÿ± ŸÖŸàÿ¨ŸàÿØ ŸÜ€åÿ≥ÿ™').replace(/'/g, "%27")}`;
                
                // Use short_description if available, otherwise persian_summary, then description
                let displayDescription = game.short_description || game.persian_summary || game.description || 'ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ ŸÖŸàÿ¨ŸàÿØ ŸÜ€åÿ≥ÿ™.';
                displayDescription = stripHtml(displayDescription); // Strip HTML tags
                const maxDescriptionLength = 150; // Limit description length for card view
                if (displayDescription.length > maxDescriptionLength) {
                    displayDescription = displayDescription.substring(0, maxDescriptionLength) + '...';
                }

                let storeInfoHtml = '';
                let getGameButtonText = 'ÿØÿ±€åÿßŸÅÿ™ ÿ®ÿßÿ≤€å';
                let getGameButtonClass = 'bg-blue-600 hover:bg-blue-700'; // Default for free games

                // Determine store display name
                let displayStoreName = game.store ? game.store.toLowerCase() : '';
                if (displayStoreName === 'google play' || displayStoreName === 'epic games (android)') {
                    displayStoreName = 'ÿßŸÜÿØÿ±Ÿà€åÿØ';
                } else if (displayStoreName === 'ios app store' || displayStoreName === 'epic games (ios)') {
                    displayStoreName = 'ÿ¢€å‚ÄåÿßŸàÿßÿ≥';
                }
                displayStoreName = storeDisplayMap[displayStoreName.replace(/\s/g, '')] || game.store;

                let dlcOrAddonTag = '';
                if (game.is_dlc_or_addon) {
                    dlcOrAddonTag = `<span class="bg-purple-600 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full mr-2">DLC/ÿßŸÅÿ≤ŸàŸÜŸá</span>`;
                }

                if (game.is_free === false) { // If it's a discounted item
                    const normalizedStoreForDisplay = game.store ? game.store.toLowerCase().replace(/\s/g, '') : '';
                    const originalStoreDisplay = storeDisplayMap[normalizedStoreForDisplay] || game.store;
                    storeInfoHtml = `<p class="text-gray-400 mb-3">ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá: ${dlcOrAddonTag}<span class="font-medium text-red-400">ÿ™ÿÆŸÅ€åŸÅ‚ÄåÿÆŸàÿ±ÿØŸá</span> ÿßÿ≤ <span class="font-medium text-purple-300">${originalStoreDisplay}</span></p>`;
                    if (game.discount_text) {
                        storeInfoHtml += `<p class="text-gray-400 mb-3"><span class="font-medium text-orange-400">ÿ¨ÿ≤ÿ¶€åÿßÿ™ ÿ™ÿÆŸÅ€åŸÅ:</span> ${game.discount_text}</p>`;
                    }
                    getGameButtonText = 'ŸÖÿ¥ÿßŸáÿØŸá ÿ™ÿÆŸÅ€åŸÅ';
                    getGameButtonClass = 'bg-green-600 hover:bg-green-700';
                } else { // If it's a truly free game
                    storeInfoHtml = `<p class="text-gray-400 mb-3">ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá: ${dlcOrAddonTag}<span class="font-medium text-purple-300">${displayStoreName}</span></p>`;
                }
                
                // Format scores and genres
                const metacriticScore = game.metacritic_score ? `<p class="text-sm text-gray-300"><i class="fas fa-star text-yellow-400"></i> <span class="font-semibold">ŸÖÿ™ÿß⁄©ÿ±€åÿ™€å⁄© (ŸÖŸÜÿ™ŸÇÿØÿßŸÜ):</span> ${game.metacritic_score}/100</p>` : '';
                const metacriticUserScore = game.metacritic_userscore ? `<p class="text-sm text-gray-300"><i class="fas fa-users text-green-400"></i> <span class="font-semibold">ŸÖÿ™ÿß⁄©ÿ±€åÿ™€å⁄© (⁄©ÿßÿ±ÿ®ÿ±ÿßŸÜ):</span> ${game.metacritic_userscore}/10</p>` : '';
                
                const steamOverallScore = game.steam_overall_score ? `<p class="text-sm text-gray-300"><i class="fab fa-steam text-blue-400"></i> <span class="font-semibold">ÿßÿ≥ÿ™€åŸÖ (⁄©ŸÑ€å):</span> ${game.steam_overall_score}% (${game.steam_overall_reviews_count || 0} ÿ±ÿß€å)</p>` : '';
                const steamRecentScore = game.steam_recent_score ? `<p class="text-sm text-gray-300"><i class="fab fa-steam-square text-blue-300"></i> <span class="font-semibold">ÿßÿ≥ÿ™€åŸÖ (ÿßÿÆ€åÿ±):</span> ${game.steam_recent_score}% (${game.steam_recent_reviews_count || 0} ÿ±ÿß€å)</p>` : '';

                const genresHtml = game.persian_genres && game.persian_genres.length > 0 ?
                    `<p class="text-sm text-gray-300"><i class="fas fa-tags text-pink-400"></i> <span class="font-semibold">⁄òÿßŸÜÿ±Ÿáÿß:</span> ${game.persian_genres.join(', ')}</p>` :
                    (game.genres && game.genres.length > 0 ?
                        `<p class="text-sm text-gray-300"><i class="fas fa-tags text-pink-400"></i> <span class="font-semibold">⁄òÿßŸÜÿ±Ÿáÿß:</span> ${game.genres.map(g => genreDisplayMap[g.toLowerCase()] || g).join(', ')}</p>` : '');

                let playerInfoHtml = '';
                if (game.is_multiplayer || game.is_online) {
                    playerInfoHtml = `<p class="text-sm text-gray-300"><i class="fas fa-users-cog text-indigo-400"></i> <span class="font-semibold">ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ:</span> `;
                    if (game.is_multiplayer && game.is_online) {
                        playerInfoHtml += `⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá ÿ¢ŸÜŸÑÿß€åŸÜ Ÿà ÿ¢ŸÅŸÑÿß€åŸÜ`;
                    } else if (game.is_multiplayer) {
                        playerInfoHtml += `⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá (ÿ¢ŸÅŸÑÿß€åŸÜ)`;
                    } else if (game.is_online) {
                        playerInfoHtml += `ŸÅŸÇÿ∑ ÿ¢ŸÜŸÑÿß€åŸÜ`;
                    }
                    playerInfoHtml += `</p>`;
                } else { // Explicitly show single-player if not multiplayer or online
                    playerInfoHtml = `<p class="text-sm text-gray-300"><i class="fas fa-user text-indigo-400"></i> <span class="font-semibold">ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ:</span> ÿ™⁄©‚ÄåŸÜŸÅÿ±Ÿá</p>`;
                }

                const ageRatingHtml = game.persian_age_rating ?
                    `<p class="text-sm text-gray-300"><i class="fas fa-child text-orange-400"></i> <span class="font-semibold">ÿ±ÿØŸá‚Äåÿ®ŸÜÿØ€å ÿ≥ŸÜ€å:</span> ${game.persian_age_rating}</p>` :
                    (game.age_rating ?
                        `<p class="text-sm text-gray-300"><i class="fas fa-child text-orange-400"></i> <span class="font-semibold">ÿ±ÿØŸá‚Äåÿ®ŸÜÿØ€å ÿ≥ŸÜ€å:</span> ${ageRatingDisplayMap[game.age_rating.toLowerCase()] || game.age_rating}</p>` : '');

                gameCard.innerHTML = `
                    <img src="${imageUrl}" alt="${game.title || 'ÿ™ÿµŸà€åÿ± ÿ®ÿßÿ≤€å'}" class="w-full h-48 sm:h-56 md:h-64 lg:h-72 xl:h-80 rounded-t-xl object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x338/374151/D1D5DB?text=${encodeURIComponent(game.title || 'ÿ™ÿµŸà€åÿ± ŸÖŸàÿ¨ŸàÿØ ŸÜ€åÿ≥ÿ™').replace(/'/g, "%27")}';">
                    <div class="p-4 flex flex-col flex-grow">
                        <h2 class="text-white text-xl font-bold mb-2 flex-grow">${game.title || 'ÿπŸÜŸàÿßŸÜ ŸÜÿßŸÖÿ¥ÿÆÿµ'}</h2>
                        ${storeInfoHtml}
                        <p class="text-gray-300 text-sm description-text mb-4">${displayDescription}</p>
                        <div class="mt-auto space-y-1">
                            ${metacriticScore}
                            ${metacriticUserScore}
                            ${steamOverallScore}
                            ${steamRecentScore}
                            ${genresHtml}
                            ${playerInfoHtml}
                            ${ageRatingHtml}
                            <a href="${game.url}" target="_blank" class="mt-4 block w-full text-center ${getGameButtonClass} text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                ${getGameButtonText}
                            </a>
                        </div>
                    </div>
                `;
                gamesContainer.appendChild(gameCard);
            });
        }

        // Function to open the modal with game details
        function openModal(game) {
            modalImage.src = game.image_url || `https://placehold.co/800x450/374151/D1D5DB?text=${encodeURIComponent(game.title || 'ÿ™ÿµŸà€åÿ± ŸÖŸàÿ¨ŸàÿØ ŸÜ€åÿ≥ÿ™').replace(/'/g, "%27")}`;
            modalImage.onerror = function() {
                this.onerror = null;
                this.src = `https://placehold.co/800x450/374151/D1D5DB?text=${encodeURIComponent(game.title || 'ÿ™ÿµŸà€åÿ± ŸÖŸàÿ¨ŸàÿØ ŸÜ€åÿ≥ÿ™').replace(/'/g, "%27")}`;
            };
            modalTitle.textContent = game.title || 'ÿπŸÜŸàÿßŸÜ ŸÜÿßŸÖÿ¥ÿÆÿµ';
            
            let displayStoreName = game.store ? game.store.toLowerCase() : '';
            if (displayStoreName === 'google play' || displayStoreName === 'epic games (android)') {
                displayStoreName = 'ÿßŸÜÿØÿ±Ÿà€åÿØ';
            } else if (displayStoreName === 'ios app store' || displayStoreName === 'epic games (ios)') {
                displayStoreName = 'ÿ¢€å‚ÄåÿßŸàÿßÿ≥';
            }
            displayStoreName = storeDisplayMap[displayStoreName.replace(/\s/g, '')] || game.store;

            let dlcOrAddonTag = '';
            if (game.is_dlc_or_addon) {
                dlcOrAddonTag = `<span class="bg-purple-600 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full mr-2">DLC/ÿßŸÅÿ≤ŸàŸÜŸá</span>`;
            }

            if (game.is_free === false) {
                const normalizedStoreForDisplay = game.store ? game.store.toLowerCase().replace(/\s/g, '') : '';
                const originalStoreDisplay = storeDisplayMap[normalizedStoreForDisplay] || game.store;
                modalStoreInfo.innerHTML = `ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá: ${dlcOrAddonTag}<span class="font-medium text-red-400">ÿ™ÿÆŸÅ€åŸÅ‚ÄåÿÆŸàÿ±ÿØŸá</span> ÿßÿ≤ <span class="font-medium text-purple-300">${originalStoreDisplay}</span>`;
                modalDiscountInfo.textContent = game.discount_text ? `ÿ¨ÿ≤ÿ¶€åÿßÿ™ ÿ™ÿÆŸÅ€åŸÅ: ${game.discount_text}` : '';
                modalDiscountInfo.classList.toggle('hidden', !game.discount_text);
                modalGameLink.textContent = 'ŸÖÿ¥ÿßŸáÿØŸá ÿ™ÿÆŸÅ€åŸÅ';
                modalGameLink.className = 'mt-4 block w-full text-center bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200';
            } else {
                modalStoreInfo.innerHTML = `ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá: ${dlcOrAddonTag}<span class="font-medium text-purple-300">${displayStoreName}</span>`;
                modalDiscountInfo.classList.add('hidden');
                modalGameLink.textContent = 'ÿØÿ±€åÿßŸÅÿ™ ÿ®ÿßÿ≤€å';
                modalGameLink.className = 'mt-4 block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200';
            }

            modalDescription.textContent = stripHtml(game.persian_summary || game.description || 'ÿ™Ÿàÿ∂€åÿ≠ÿßÿ™ ŸÖŸàÿ¨ŸàÿØ ŸÜ€åÿ≥ÿ™.');

            modalMetacriticScore.textContent = game.metacritic_score ? `ŸÖÿ™ÿß⁄©ÿ±€åÿ™€å⁄© (ŸÖŸÜÿ™ŸÇÿØÿßŸÜ): ${game.metacritic_score}/100` : '';
            modalMetacriticUserScore.textContent = game.metacritic_userscore ? `ŸÖÿ™ÿß⁄©ÿ±€åÿ™€å⁄© (⁄©ÿßÿ±ÿ®ÿ±ÿßŸÜ): ${game.metacritic_userscore}/10` : '';
            modalSteamOverallScore.textContent = game.steam_overall_score ? `ÿßÿ≥ÿ™€åŸÖ (⁄©ŸÑ€å): ${game.steam_overall_score}% (${game.steam_overall_reviews_count || 0} ÿ±ÿß€å)` : '';
            modalSteamRecentScore.textContent = game.steam_recent_score ? `ÿßÿ≥ÿ™€åŸÖ (ÿßÿÆ€åÿ±): ${game.steam_recent_score}% (${game.steam_recent_reviews_count || 0} ÿ±ÿß€å)` : '';

            const translatedGenres = game.persian_genres && game.persian_genres.length > 0 ?
                game.persian_genres.join(', ') :
                (game.genres && game.genres.length > 0 ?
                    game.genres.map(g => genreDisplayMap[g.toLowerCase()] || g).join(', ') : '');
            modalGenres.textContent = translatedGenres ? `⁄òÿßŸÜÿ±Ÿáÿß: ${translatedGenres}` : '';

            let playerInfo = '';
            if (game.is_multiplayer || game.is_online) {
                playerInfo = `ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ: `;
                if (game.is_multiplayer && game.is_online) {
                    playerInfo += `⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá ÿ¢ŸÜŸÑÿß€åŸÜ Ÿà ÿ¢ŸÅŸÑÿß€åŸÜ`;
                } else if (game.is_multiplayer) {
                    playerInfo += `⁄ÜŸÜÿØŸÜŸÅÿ±Ÿá (ÿ¢ŸÅŸÑÿß€åŸÜ)`;
                } else if (game.is_online) {
                    playerInfo += `ŸÅŸÇÿ∑ ÿ¢ŸÜŸÑÿß€åŸÜ`;
                }
            } else { // Explicitly show single-player if not multiplayer or online
                playerInfo = `ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ: ÿ™⁄©‚ÄåŸÜŸÅÿ±Ÿá`;
            }
            modalPlayerInfo.textContent = playerInfo;

            const translatedAgeRating = game.persian_age_rating || (game.age_rating ? ageRatingDisplayMap[game.age_rating.toLowerCase()] || game.age_rating : '');
            modalAgeRating.textContent = translatedAgeRating ? `ÿ±ÿØŸá‚Äåÿ®ŸÜÿØ€å ÿ≥ŸÜ€å: ${translatedAgeRating}` : '';

            modalTrailerLink.href = game.trailer || '#';
            modalTrailerLink.classList.toggle('hidden', !game.trailer);
            
            modalGameLink.href = game.url || '#';

            gameDetailModal.style.display = 'flex'; // Use flex to center content
            document.body.style.overflow = 'hidden'; // Prevent scrolling body when modal is open
        }

        // Function to close the modal
        function closeModal() {
            gameDetailModal.style.display = 'none';
            document.body.style.overflow = ''; // Restore body scrolling
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            if (event.target == gameDetailModal) {
                closeModal();
            }
        }

        // Function to populate store filter options
        function populateStoreFilter() {
            const uniqueStores = new Set();
            allGames.forEach(game => {
                if (game.store) {
                    let normalizedStore = game.store.toLowerCase().replace(/\s/g, '');
                    // Handle Epic Games (Android/iOS) and Google Play/iOS App Store as "Android" / "iOS"
                    if (normalizedStore === 'googleplay' || normalizedStore === 'epicgames(android)') {
                        uniqueStores.add('android');
                    } else if (normalizedStore === 'iosappstore' || normalizedStore === 'epicgames(ios)') {
                        uniqueStores.add('ios');
                    } else {
                        uniqueStores.add(normalizedStore);
                    }
                }
            });

            // Convert set to array and sort according to desired order
            const sortedStores = Array.from(uniqueStores).sort((a, b) => {
                const faA = storeDisplayMap[a] || a;
                const faB = storeDisplayMap[b] || b;
                const indexA = storeDisplayOrder.indexOf(faA);
                const indexB = storeDisplayOrder.indexOf(faB);
                return indexA - indexB;
            });

            // Clear existing options except "ŸáŸÖŸá ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß"
            storeFilter.innerHTML = '<option value="all">ŸáŸÖŸá ŸÅÿ±Ÿàÿ¥⁄ØÿßŸá‚ÄåŸáÿß</option>';
            sortedStores.forEach(storeKey => {
                const option = document.createElement('option');
                option.value = storeKey;
                option.textContent = storeDisplayMap[storeKey] || storeKey;
                storeFilter.appendChild(option);
            });
        }

        // Function to apply all filters
        function applyFilter() {
            const selectedStore = storeFilter.value;
            const selectedContentType = contentTypeFilter.value;
            const selectedPriceType = priceTypeFilter.value;

            const filteredGames = allGames.filter(game => {
                // Filter by store
                let gameStoreNormalized = game.store ? game.store.toLowerCase().replace(/\s/g, '') : '';
                if (gameStoreNormalized === 'googleplay' || gameStoreNormalized === 'epicgames(android)') {
                    gameStoreNormalized = 'android';
                } else if (gameStoreNormalized === 'iosappstore' || gameStoreNormalized === 'epicgames(ios)') {
                    gameStoreNormalized = 'ios';
                }

                const storeMatch = selectedStore === 'all' || gameStoreNormalized === selectedStore;

                // Filter by content type
                let contentTypeMatch = true;
                if (selectedContentType === 'games-only') {
                    contentTypeMatch = !game.is_dlc_or_addon;
                } else if (selectedContentType === 'dlc-only') {
                    contentTypeMatch = game.is_dlc_or_addon;
                }

                // Filter by price type
                let priceTypeMatch = true;
                if (selectedPriceType === 'free-only') {
                    priceTypeMatch = game.is_free === true;
                } else if (selectedPriceType === 'discounted-only') {
                    priceTypeMatch = game.is_free === false;
                }

                return storeMatch && contentTypeMatch && priceTypeMatch;
            });
            renderGames(filteredGames);
        }

        // Fetch games data from JSON file
        async function fetchGames() {
            loadingMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            noGamesMessage.classList.add('hidden');
            try {
                const response = await fetch('free_games.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allGames = await response.json();
                // Sort games by title alphabetically (case-insensitive)
                allGames.sort((a, b) => (a.title || '').localeCompare(b.title || '', 'fa', { sensitivity: 'base' }));
                
                populateStoreFilter(); // Populate filter options after fetching games
                
                // Set initial column layout from local storage or default to 3
                const savedColumns = localStorage.getItem('selectedColumns');
                const initialColumns = savedColumns ? parseInt(savedColumns) : 3;
                columnSelector.value = initialColumns;
                applyColumnLayout(initialColumns); // This will also call applyFilter()
                
            } catch (error) {
                console.error("Error fetching games:", error);
                errorMessage.classList.remove('hidden');
            } finally {
                loadingMessage.classList.add('hidden');
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            fetchGames();

            storeFilter.addEventListener('change', applyFilter);
            contentTypeFilter.addEventListener('change', applyFilter);
            priceTypeFilter.addEventListener('change', applyFilter);
            columnSelector.addEventListener('change', (event) => {
                applyColumnLayout(parseInt(event.target.value));
            });

            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.contains('dark');
                setTheme(!isDark);
            });

            // Scroll buttons logic
            window.addEventListener('scroll', () => {
                if (window.scrollY > 200) { // Show after scrolling down 200px
                    scrollToTopBtn.classList.add('show');
                } else {
                    scrollToTopBtn.classList.remove('show');
                }

                if ((window.innerHeight + window.scrollY) < document.body.offsetHeight - 200) { // Show if not near bottom
                    scrollToBottomBtn.classList.add('show');
                } else {
                    scrollToBottomBtn.classList.remove('show');
                }
            });

            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            scrollToBottomBtn.addEventListener('click', () => {
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
