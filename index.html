<!DOCTYPE html>
<html lang="fa" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ù…Ø±ÙˆØ²</title>
    <!-- Favicon (using an emoji as SVG data URI) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ®</text></svg>">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vazirmatn Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            direction: rtl; /* Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ */
            text-align: right; /* ØªØ±Ø§Ø² Ù…ØªÙ† Ø¨Ù‡ Ø±Ø§Ø³Øª */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Dark Mode Styles (default) */
        .dark {
            background: linear-gradient(to bottom right, #1a202c, #2d3748); /* Darker gradient */
            color: #e2e8f0; /* Light text */
        }
        .dark .bg-gray-700 {
            background-color: #4a5568; /* Darker card background */
        }
        .dark .text-gray-400 {
            color: #a0aec0;
        }
        .dark .text-gray-300 {
            color: #cbd5e0;
        }
        .dark .border-gray-600 {
            border-color: #4a5568;
        }
        .dark .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }

        /* Light Mode Styles */
        html.light {
            background: linear-gradient(to bottom right, #f7fafc, #edf2f7); /* Lighter gradient */
            color: #2d3748; /* Dark text */
        }
        html.light .bg-gray-700 {
            background-color: #ffffff; /* White card background */
            border: 1px solid #e2e8f0;
        }
        html.light .text-gray-400 {
            color: #4a5568;
        }
        html.light .text-gray-300 {
            color: #2d3748;
        }
        html.light .border-gray-600 {
            border-color: #e2e8f0;
        }
        html.light .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        html.light .text-white {
            color: #1a202c;
        }
        html.light .bg-clip-text {
            background-image: linear-gradient(to right, #007bff, #6f42c1); /* Adjust gradient for light mode */
        }

        /* Common card styles */
        .game-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex; /* Ensures content fills height */
            flex-direction: column; /* Stacks content vertically */
            height: 100%; /* Ensure cards in a row have equal height */
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        .game-card img {
            object-fit: cover; /* Ensures images cover the area without distortion */
            height: 192px; /* Default h-48 */
            width: 100%; /* Ensure image fills its container */
        }
        .game-card .p-4 {
            flex-grow: 1; /* Allows content area to expand */
            display: flex;
            flex-direction: column;
        }
        /* Description text truncation for card view */
        .game-card .description-summary {
            flex-grow: 1;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Default to 3 lines for summary */
            -webkit-box-orient: vertical;
            text-overflow: ellipsis;
            margin-bottom: 1rem; /* Space before the button */
        }

        /* Info items on cards */
        .card-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Responsive grid for info items */
            gap: 8px; /* Gap between info items */
            margin-bottom: 12px;
        }
        .card-info-item {
            display: flex;
            align-items: center;
            font-size: 0.875rem; /* text-sm */
            color: #cbd5e0;
            white-space: nowrap; /* Prevent wrapping for single items */
        }
        .card-info-item i {
            margin-left: 8px; /* Smaller margin for icons on cards */
            color: #63b3ed;
            flex-shrink: 0; /* Prevent icon from shrinking */
        }
        .card-info-item span {
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis; /* Truncate long text */
        }
        /* Buttons on card */
        .card-button {
            display: block;
            width: 100%;
            text-align: center;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.2s;
            margin-top: 10px; /* Space between info grid and button */
        }
        .card-button.get-game {
            background-color: #4299e1; /* Blue */
            color: white;
        }
        .card-button.get-game:hover {
            background-color: #3182ce;
            transform: translateY(-2px);
        }
        .card-button.view-discount {
            background-color: #38a169; /* Green */
            color: white;
        }
        .card-button.view-discount:hover {
            background-color: #2f855a;
            transform: translateY(-2px);
        }
        .card-button.trailer {
            background-color: #6b46c1; /* Purple */
            color: white;
            margin-top: 10px;
        }
        .card-button.trailer:hover {
            background-color: #553c9a;
            transform: translateY(-2px);
        }


        /* Custom styles for the theme toggle button */
        #theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .dark #theme-toggle {
            background-color: #4a5568;
            color: #f7fafc;
        }
        html.light #theme-toggle {
            background-color: #fff;
            color: #2d3748;
        }
        #theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Scroll buttons */
        .scroll-button {
            position: fixed;
            right: 20px;
            background-color: #3182ce; /* Blue-600 */
            color: white;
            padding: 12px;
            border-radius: 9999px; /* Full rounded */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            z-index: 90;
            transition: opacity 0.3s, transform 0.3s;
            opacity: 0; /* Hidden by default */
            transform: scale(0.9);
        }
        .scroll-button:hover {
            background-color: #2b6cb0; /* Blue-700 */
            transform: scale(1);
        }
        .scroll-button.show {
            opacity: 1;
            transform: scale(1);
        }
        #scroll-to-top {
            bottom: 80px;
        }
        #scroll-to-bottom {
            bottom: 20px;
        }

        /* Responsive layout adjustments for grid columns */
        /* Apply grid-template-columns directly to the element with layout-cols-X */
        .layout-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        /* For 2 columns */
        .layout-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        @media (min-width: 640px) { /* sm breakpoint */
            .layout-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        /* For 3 columns (Default) */
        .layout-cols-3 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        @media (min-width: 640px) { /* sm breakpoint */
            .layout-cols-3 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            .layout-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }
        /* For 4 columns */
        .layout-cols-4 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        @media (min-width: 640px) { /* sm breakpoint */
            .layout-cols-4 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        @media (min-width: 1024px) { /* lg breakpoint */
            .layout-cols-4 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        }
        @media (min-width: 1280px) { /* xl breakpoint */
            .layout-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        }

    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-gray-100 min-h-screen p-4 sm:p-8">
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" class="bg-gray-700 text-white rounded-full p-2">
        â˜€ï¸
    </button>

    <div class="container mx-auto max-w-7xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-4">
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-600">
                    Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ù…Ø±ÙˆØ²
                </span>
            </h1>
            <p class="text-lg sm:text-xl text-gray-300">
                Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ùˆ ØªØ®ÙÛŒÙâ€ŒØ®ÙˆØ±Ø¯Ù‡ Ø§Ø² ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯!
            </p>
        </header>

        <!-- Filter and Layout Options -->
        <div class="mb-8 flex flex-col sm:flex-row items-center justify-center gap-4 flex-wrap">
            <!-- Store Filter -->
            <label for="store-filter" class="text-lg font-medium text-gray-300 whitespace-nowrap">
                ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ±ÙˆØ´Ú¯Ø§Ù‡:
            </label>
            <select id="store-filter" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="all">Ù‡Ù…Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§</option>
                <!-- Options will be populated by JavaScript -->
            </select>

            <!-- Content Type Filter -->
            <label for="content-type-filter" class="text-lg font-medium text-gray-300 whitespace-nowrap">
                Ù†ÙˆØ¹ Ù…Ø­ØªÙˆØ§:
            </label>
            <select id="content-type-filter" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="all-content">Ù‡Ù…Ù‡ (Ø¨Ø§Ø²ÛŒ Ùˆ Ø§ÙØ²ÙˆÙ†Ù‡)</option>
                <option value="games-only">ÙÙ‚Ø· Ø¨Ø§Ø²ÛŒ</option>
                <option value="dlc-only">ÙÙ‚Ø· DLC Ùˆ Ø§ÙØ²ÙˆÙ†Ù‡</option>
            </select>

            <!-- Price Type Filter -->
            <label for="price-type-filter" class="text-lg font-medium text-gray-300 whitespace-nowrap">
                Ù†ÙˆØ¹ Ù‚ÛŒÙ…Øª:
            </label>
            <select id="price-type-filter" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="all-prices">Ù‡Ù…Ù‡ (Ø±Ø§ÛŒÚ¯Ø§Ù† Ùˆ ØªØ®ÙÛŒÙ)</option>
                <option value="free-only">ÙÙ‚Ø· Ø±Ø§ÛŒÚ¯Ø§Ù†</option>
                <option value="discounted-only">ÙÙ‚Ø· ØªØ®ÙÛŒÙâ€ŒØ®ÙˆØ±Ø¯Ù‡</option>
            </select>

            <!-- Column Selector -->
            <label for="column-selector" class="text-lg font-medium text-gray-300 whitespace-nowrap sm:mr-4">
                ØªØ¹Ø¯Ø§Ø¯ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§:
            </label>
            <select id="column-selector" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="1">Û± Ø³ØªÙˆÙ† (Ø¨Ø²Ø±Ú¯)</option>
                <option value="2">Û² Ø³ØªÙˆÙ† (Ù…ØªÙˆØ³Ø·)</option>
                <option value="3">Û³ Ø³ØªÙˆÙ† (Ú©ÙˆÚ†Ú©)</option>
                <option value="4">Û´ Ø³ØªÙˆÙ† (Ø®ÛŒÙ„ÛŒ Ú©ÙˆÚ†Ú©)</option>
            </select>
        </div>

        <div id="loading" class="text-center text-xl text-blue-400 mb-8">
            Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§...
        </div>

        <div id="error-message" class="hidden text-center text-xl text-red-400 mb-8">
            Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§. Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.
        </div>

        <div id="no-games-message" class="hidden text-center text-xl text-gray-400 mb-8">
            Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù‡ÛŒÚ† Ø¨Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.
        </div>

        <!-- games-container will dynamically get grid-cols and layout-cols classes -->
        <div id="games-container" class="grid gap-6"> 
            <!-- Game cards will be injected here by JavaScript -->
        </div>
    </div>

    <!-- Scroll to Top Button -->
    <button id="scroll-to-top" class="scroll-button">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Scroll to Bottom Button -->
    <button id="scroll-to-bottom" class="scroll-button">
        <i class="fas fa-arrow-down"></i>
    </button>

    <script>
        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù…ØªÙ† Ø§Ø² ØªÚ¯â€ŒÙ‡Ø§ÛŒ HTML Ùˆ Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø®Ø§Øµ
        function cleanText(text) {
            if (!text) return '';
            // Ø­Ø°Ù ØªÚ¯â€ŒÙ‡Ø§ÛŒ HTML (Ù…Ø§Ù†Ù†Ø¯ <div class="bb_img_ctn">, <p>, <h2>, <img>, <video>)
            let cleaned = text.replace(/<[^>]*>/g, '');
            // Ø­Ø°Ù Ù‡Ø±Ú¯ÙˆÙ†Ù‡ URL Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ú©Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ù…ØªÙ† Ø¸Ø§Ù‡Ø± Ø´ÙˆØ¯
            cleaned = cleaned.replace(/(https?:\/\/[^\s]+)/g, '');
            // Ø­Ø°Ù ÙØ¶Ø§Ù‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
            cleaned = cleaned.replace(/\s\s+/g, ' ').trim();
            return cleaned;
        }

        let allGames = []; // To store all fetched games
        const gamesContainer = document.getElementById('games-container');
        const loadingMessage = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const noGamesMessage = document.getElementById('no-games-message');
        const storeFilter = document.getElementById('store-filter');
        const columnSelector = document.getElementById('column-selector'); // Column selector
        const themeToggle = document.getElementById('theme-toggle');
        const scrollToTopBtn = document.getElementById('scroll-to-top');
        const scrollToBottomBtn = document.getElementById('scroll-to-bottom');
        
        // Filter elements
        const contentTypeFilter = document.getElementById('content-type-filter'); 
        const priceTypeFilter = document.getElementById('price-type-filter'); 

        // Ù†Ú¯Ø§Ø´Øª Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
        const storeDisplayMap = {
            "epicgames": "Ø§Ù¾ÛŒÚ© Ú¯ÛŒÙ…Ø²",
            "steam": "Ø§Ø³ØªÛŒÙ…",
            "googleplay": "Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯",
            "epicgames(android)": "Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯",
            "epicgames(ios)": "Ø¢ÛŒâ€ŒØ§ÙˆØ§Ø³",
            "iosappstore": "Ø¢ÛŒâ€ŒØ§ÙˆØ§Ø³",
            "playstation": "Ù¾Ù„ÛŒâ€ŒØ§Ø³ØªÛŒØ´Ù†",
            "xbox": "Ø§ÛŒÚ©Ø³â€ŒØ¨Ø§Ú©Ø³",
            "gog": "GOG",
            "itch.io": "Itch.io",
            "indiegala": "Ø§ÛŒÙ†Ø¯ÛŒâ€ŒÚ¯Ø§Ù„Ø§",
            "stove": "STOVE",
            "other": "Ø³Ø§ÛŒØ± ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§",
            "reddit": "Ø±Ø¯ÛŒØª (Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ…)",
            "android": "Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯",
            "ios": "Ø¢ÛŒâ€ŒØ§ÙˆØ§Ø³",
            "microsoftstore": "Ù…Ø§ÛŒÚ©Ø±ÙˆØ³Ø§ÙØª Ø§Ø³ØªÙˆØ±",
            "humblestore": "Ù‡Ø§Ù…Ø¨Ù„ Ø§Ø³ØªÙˆØ±",
            "fanatical": "ÙÙ†Ø§ØªÛŒÚ©Ø§Ù„",
            "greenmangaming": "Ú¯Ø±ÛŒÙ† Ù…Ù† Ú¯ÛŒÙ…ÛŒÙ†Ú¯",
            "amazon": "Ø¢Ù…Ø§Ø²ÙˆÙ†",
            "blizzard": "Ø¨Ù„ÛŒØ²Ø§Ø±Ø¯",
            "eastore": "EA Ø§Ø³ØªÙˆØ±",
            "ubisoftstore": "ÛŒÙˆØ¨ÛŒâ€ŒØ³Ø§ÙØª Ø§Ø³ØªÙˆØ±"
        };

        // ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´ Ø¯Ù„Ø®ÙˆØ§Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§ (Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ)
        const storeDisplayOrder = [
            "Ù‡Ù…Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§",
            "Ø§Ø³ØªÛŒÙ…",
            "Ø§Ù¾ÛŒÚ© Ú¯ÛŒÙ…Ø²",
            "Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯",
            "Ø¢ÛŒâ€ŒØ§ÙˆØ§Ø³",
            "Ù¾Ù„ÛŒâ€ŒØ§Ø³ØªÛŒØ´Ù†",
            "Ø§ÛŒÚ©Ø³â€ŒØ¨Ø§Ú©Ø³",
            "GOG",
            "Itch.io",
            "Ø§ÛŒÙ†Ø¯ÛŒâ€ŒÚ¯Ø§Ù„Ø§",
            "STOVE",
            "Ù…Ø§ÛŒÚ©Ø±ÙˆØ³Ø§ÙØª Ø§Ø³ØªÙˆØ±",
            "Ù‡Ø§Ù…Ø¨Ù„ Ø§Ø³ØªÙˆØ±",
            "ÙÙ†Ø§ØªÛŒÚ©Ø§Ù„",
            "Ú¯Ø±ÛŒÙ† Ù…Ù† Ú¯ÛŒÙ…ÛŒÙ†Ú¯",
            "Ø¢Ù…Ø§Ø²ÙˆÙ†",
            "Ø¨Ù„ÛŒØ²Ø§Ø±Ø¯",
            "EA Ø§Ø³ØªÙˆØ±",
            "ÛŒÙˆØ¨ÛŒâ€ŒØ³Ø§ÙØª Ø§Ø³ØªÙˆØ±",
            "Ø±Ø¯ÛŒØª (Ù„ÛŒÙ†Ú© Ù…Ø³ØªÙ‚ÛŒÙ…)",
            "Ø³Ø§ÛŒØ± ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§"
        ];

        // Ù†Ú¯Ø§Ø´Øª Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ú˜Ø§Ù†Ø±Ù‡Ø§ Ø¨Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ
        const genreDisplayMap = {
            "action": "Ø§Ú©Ø´Ù†", "adventure": "Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ", "rpg": "Ù†Ù‚Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ", "strategy": "Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ",
            "simulation": "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ", "sports": "ÙˆØ±Ø²Ø´ÛŒ", "puzzle": "Ù¾Ø§Ø²Ù„", "indie": "Ø§ÛŒÙ†Ø¯ÛŒ",
            "casual": "Ú©Ú˜ÙˆØ§Ù„", "racing": "Ù…Ø³Ø§Ø¨Ù‚Ù‡â€ŒØ§ÛŒ", "fighting": "Ù…Ø¨Ø§Ø±Ø²Ù‡â€ŒØ§ÛŒ", "horror": "ØªØ±Ø³Ù†Ø§Ú©",
            "survival": "Ø¨Ù‚Ø§", "shooter": "Ø´ÙˆØªØ±", "massively multiplayer": "Ú†Ù†Ø¯Ù†ÙØ±Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú¯Ø³ØªØ±Ø¯Ù‡",
            "early access": "Ø¯Ø³ØªØ±Ø³ÛŒ Ø²ÙˆØ¯Ù‡Ù†Ú¯Ø§Ù…", "free to play": "Ø±Ø§ÛŒÚ¯Ø§Ù†", "arcade": "Ø¢Ø±Ú©ÛŒØ¯",
            "platformer": "Ù¾Ù„ØªÙØ±Ù…Ø±", "rhythm": "Ø±ÛŒØªÙ…ÛŒÚ©", "educational": "Ø¢Ù…ÙˆØ²Ø´ÛŒ", "family": "Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ",
            "music": "Ù…ÙˆØ³ÛŒÙ‚ÛŒ", "board game": "Ø¨Ø§Ø²ÛŒ Ø±ÙˆÙ…ÛŒØ²ÛŒ", "card game": "Ø¨Ø§Ø²ÛŒ Ú©Ø§Ø±ØªÛŒ",
            "visual novel": "Ø±Ù…Ø§Ù† ØªØµÙˆÛŒØ±ÛŒ", "point & click": "Ø§Ø´Ø§Ø±Ù‡ Ùˆ Ú©Ù„ÛŒÚ©", "turn-based": "Ù†ÙˆØ¨ØªÛŒ",
            "real-time strategy": "Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù‡Ù…â€ŒØ²Ù…Ø§Ù†", "tower defense": "Ø¯ÙØ§Ø¹ Ø§Ø² Ø¨Ø±Ø¬", "role-playing": "Ù†Ù‚Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ",
            "open world": "Ø¬Ù‡Ø§Ù† Ø¨Ø§Ø²", "sandbox": "Ø³Ù†Ø¯Ø¨Ø§Ú©Ø³", "stealth": "Ù…Ø®ÙÛŒâ€ŒÚ©Ø§Ø±ÛŒ",
            "puzzle-platformer": "Ù¾Ù„ØªÙØ±Ù…Ø± Ù¾Ø§Ø²Ù„ÛŒ", "metroidvania": "Ù…ØªØ±ÙˆÛŒØ¯ÙˆØ§Ù†ÛŒØ§", "roguelike": "Ø±ÙˆÚ¯â€ŒÙ„Ø§ÛŒÚ©",
            "rogue-lite": "Ø±ÙˆÚ¯â€ŒÙ„Ø§ÛŒØª", "city-builder": "Ø´Ù‡Ø±Ø³Ø§Ø²ÛŒ", "grand strategy": "Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ø¨Ø²Ø±Ú¯",
            "wargame": "Ø¨Ø§Ø²ÛŒ Ø¬Ù†Ú¯ÛŒ", "historical": "ØªØ§Ø±ÛŒØ®ÛŒ", "fantasy": "ÙØ§Ù†ØªØ²ÛŒ", "sci-fi": "Ø¹Ù„Ù…ÛŒ ØªØ®ÛŒÙ„ÛŒ",
            "cyberpunk": "Ø³Ø§ÛŒØ¨Ø±Ù¾Ø§Ù†Ú©", "post-apocalyptic": "Ù¾Ø³Ø§Ø¢Ø®Ø±Ø§Ù„Ø²Ù…Ø§Ù†ÛŒ", "superhero": "Ø§Ø¨Ø±Ù‚Ù‡Ø±Ù…Ø§Ù†ÛŒ",
            "anime": "Ø§Ù†ÛŒÙ…Ù‡", "pixel graphics": "Ú¯Ø±Ø§ÙÛŒÚ© Ù¾ÛŒÚ©Ø³Ù„ÛŒ", "2d": "Ø¯ÙˆØ¨Ø¹Ø¯ÛŒ", "3d": "Ø³Ù‡â€ŒØ¨Ø¹Ø¯ÛŒ",
            "vr": "ÙˆØ§Ù‚Ø¹ÛŒØª Ù…Ø¬Ø§Ø²ÛŒ", "co-op": "Ù‡Ù…Ú©Ø§Ø±ÛŒ", "multiplayer": "Ú†Ù†Ø¯Ù†ÙØ±Ù‡", "singleplayer": "ØªÚ©â€ŒÙ†ÙØ±Ù‡",
            "online multi-player": "Ú†Ù†Ø¯Ù†ÙØ±Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†", "local multi-player": "Ú†Ù†Ø¯Ù†ÙØ±Ù‡ Ù…Ø­Ù„ÛŒ",
            "online co-op": "Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†", "local co-op": "Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù…Ø­Ù„ÛŒ", "controller support": "Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ú©Ù†ØªØ±Ù„Ø±",
            "full controller support": "Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Ø§Ø² Ú©Ù†ØªØ±Ù„Ø±", "partial controller support": "Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø¬Ø²Ø¦ÛŒ Ø§Ø² Ú©Ù†ØªØ±Ù„Ø±",
            "steam achievements": "Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§", "steam trading cards": "Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØ¬Ø§Ø±ÛŒ Ø§Ø³ØªÛŒÙ…",
            "steam cloud": "Ø°Ø®ÛŒØ±Ù‡ Ø§Ø¨Ø±ÛŒ Ø§Ø³ØªÛŒÙ…", "steam workshop": "Ú©Ø§Ø±Ú¯Ø§Ù‡ Ø§Ø³ØªÛŒÙ…", "in-app purchases": "Ø®Ø±ÛŒØ¯ Ø¯Ø±ÙˆÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ",
            "rts": "Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ Ù‡Ù…â€ŒØ²Ù…Ø§Ù† (RTS)", "fps": "Ø´ÙˆØªØ± Ø§ÙˆÙ„ Ø´Ø®Øµ (FPS)", "tps": "Ø´ÙˆØªØ± Ø³ÙˆÙ… Ø´Ø®Øµ (TPS)",
            "moba": "Ù…ÛŒØ¯Ø§Ù† Ù†Ø¨Ø±Ø¯ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú†Ù†Ø¯Ù†ÙØ±Ù‡ (MOBA)", "mmorpg": "Ù†Ù‚Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ† Ú†Ù†Ø¯Ù†ÙØ±Ù‡ Ú¯Ø³ØªØ±Ø¯Ù‡ (MMORPG)",
            "jrpg": "Ù†Ù‚Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ Ú˜Ø§Ù¾Ù†ÛŒ (JRPG)", "western rpg": "Ù†Ù‚Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ ØºØ±Ø¨ÛŒ", "dating sim": "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø¯ÙˆØ³ØªÛŒØ§Ø¨ÛŒ",
            "farming sim": "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ", "life sim": "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ø²Ù†Ø¯Ú¯ÛŒ", "tycoon": "ØªØ§ÛŒÚ¯ÙˆÙ†",
            "management": "Ù…Ø¯ÛŒØ±ÛŒØª", "building": "Ø³Ø§Ø®Øª Ùˆ Ø³Ø§Ø²", "crafting": "Ø³Ø§Ø®Øª Ùˆ Ø³Ø§Ø²",
            "survival horror": "ÙˆØ­Ø´Øª Ø¨Ù‚Ø§", "psychological horror": "ÙˆØ­Ø´Øª Ø±ÙˆØ§Ù†â€ŒØ´Ù†Ø§Ø®ØªÛŒ",
            "action rpg": "Ù†Ù‚Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ Ø§Ú©Ø´Ù†", "adventure rpg": "Ù†Ù‚Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ", "puzzle adventure": "Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ Ù¾Ø§Ø²Ù„ÛŒ",
            "hidden object": "Ø§Ø´ÛŒØ§Ø¡ Ù¾Ù†Ù‡Ø§Ù†", "match 3": "Ø¬ÙˆØ±Ú†ÛŒÙ† Û³", "card battle": "Ù†Ø¨Ø±Ø¯ Ú©Ø§Ø±ØªÛŒ",
            "deckbuilding": "Ø³Ø§Ø®Øª Ø¹Ø±Ø´Ù‡", "tabletop": "Ø±ÙˆÙ…ÛŒØ²ÛŒ", "party game": "Ø¨Ø§Ø²ÛŒ Ù…Ù‡Ù…Ø§Ù†ÛŒ",
            "trivia": "Ø¯Ø§Ù†Ø³ØªÙ†ÛŒâ€ŒÙ‡Ø§", "kids": "Ú©ÙˆØ¯Ú©Ø§Ù†", "dance": "Ø±Ù‚Øµ", "karaoke": "Ú©Ø§Ø±Ø§Ø¦ÙˆÚ©Ù‡",
            "exercise": "ÙˆØ±Ø²Ø´ÛŒ", "fitness": "ØªÙ†Ø§Ø³Ø¨ Ø§Ù†Ø¯Ø§Ù…", "vr exclusive": "Ø§Ù†Ø­ØµØ§Ø±ÛŒ ÙˆØ§Ù‚Ø¹ÛŒØª Ù…Ø¬Ø§Ø²ÛŒ",
            "vr support": "Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ÙˆØ§Ù‚Ø¹ÛŒØª Ù…Ø¬Ø§Ø²ÛŒ", "room-scale": "Ù…Ù‚ÛŒØ§Ø³ Ø§ØªØ§Ù‚", "seated": "Ù†Ø´Ø³ØªÙ‡",
            "standing": "Ø§ÛŒØ³ØªØ§Ø¯Ù‡", "motion controls": "Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø­Ø±Ú©ØªÛŒ", "online pvp": "Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¢Ù†Ù„Ø§ÛŒÙ†",
            "local pvp": "Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²ÛŒÚ©Ù† Ù…Ø­Ù„ÛŒ", "competitive": "Ø±Ù‚Ø§Ø¨ØªÛŒ", "co-op campaign": "Ú©Ù…Ù¾ÛŒÙ† Ù‡Ù…Ú©Ø§Ø±ÛŒ",
            "pvp": "Ø¨Ø§Ø²ÛŒÚ©Ù† Ø¯Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²ÛŒÚ©Ù†", "online": "Ø¢Ù†Ù„Ø§ÛŒÙ†", "offline": "Ø¢ÙÙ„Ø§ÛŒÙ†", "local": "Ù…Ø­Ù„ÛŒ",
            "controller": "Ú©Ù†ØªØ±Ù„Ø±", "keyboard": "Ú©ÛŒØ¨ÙˆØ±Ø¯", "mouse": "Ù…ÙˆØ³", "touch": "Ù„Ù…Ø³ÛŒ",
            "voxel": "ÙˆÚ©Ø³Ù„", "hand-drawn": "Ù†Ù‚Ø§Ø´ÛŒ Ø¯Ø³ØªÛŒ", "stylized": "Ø³Ø¨Ú©â€ŒØ¯Ø§Ø±", "minimalist": "Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„ÛŒØ³ØªÛŒ",
            "abstract": "Ø§Ù†ØªØ²Ø§Ø¹ÛŒ", "beautiful": "Ø²ÛŒØ¨Ø§", "atmospheric": "Ø¬ÙˆÚ¯ÛŒØ±", "relaxing": "Ø¢Ø±Ø§Ù…Ø´â€ŒØ¨Ø®Ø´",
            "meditation": "Ù…Ø¯ÛŒØªÛŒØ´Ù†", "comedy": "Ú©Ù…Ø¯ÛŒ", "dark comedy": "Ú©Ù…Ø¯ÛŒ Ø³ÛŒØ§Ù‡", "satire": "Ù‡Ø¬Ùˆ",
            "political": "Ø³ÛŒØ§Ø³ÛŒ", "social commentary": "Ù†Ù‚Ø¯ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ", "dystopian": "Ø¯ÛŒØ³ØªÙˆÙ¾ÛŒØ§ÛŒÛŒ",
            "utopian": "Ø¢Ø±Ù…Ø§Ù†â€ŒØ´Ù‡Ø±ÛŒ", "surreal": "Ø³ÙˆØ±Ø¦Ø§Ù„", "experimental": "ØªØ¬Ø±Ø¨ÛŒ", "art game": "Ø¨Ø§Ø²ÛŒ Ù‡Ù†Ø±ÛŒ",
            "walking simulator": "Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø² Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ±ÙˆÛŒ"
        };

        // Ù†Ú¯Ø§Ø´Øª Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø³Ù†ÛŒ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù‡ Ù†Ø§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ
        const ageRatingDisplayMap = {
            "esrb everyone": "ESRB: Ù‡Ù…Ù‡", "esrb everyone 10+": "ESRB: Ù‡Ù…Ù‡ Û±Û°+", "esrb teen": "ESRB: Ù†ÙˆØ¬ÙˆØ§Ù†",
            "esrb mature": "ESRB: Ø¨Ø²Ø±Ú¯Ø³Ø§Ù„", "esrb adults only": "ESRB: ÙÙ‚Ø· Ø¨Ø²Ø±Ú¯Ø³Ø§Ù„Ø§Ù†", "pegi 3": "PEGI: Û³+",
            "pegi 7": "PEGI: Û·+", "pegi 12": "PEGI: Û±Û²+", "pegi 16": "PEGI: Û±Û¶+", "pegi 18": "PEGI: Û±Û¸+",
            "cero a": "CERO: A (Ù‡Ù…Ù‡ Ø³Ù†ÛŒÙ†)", "cero b": "CERO: B (Û±Û²+)", "cero c": "CERO: C (Û±Ûµ+)",
            "cero d": "CERO: D (Û±Û·+)", "cero z": "CERO: Z (Û±Û¸+)", "rating pending": "Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø± Ø¯Ø³Øª Ø¨Ø±Ø±Ø³ÛŒ",
            "rp": "Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø± Ø¯Ø³Øª Ø¨Ø±Ø±Ø³ÛŒ", "ao": "ÙÙ‚Ø· Ø¨Ø²Ø±Ú¯Ø³Ø§Ù„Ø§Ù†", "m": "Ø¨Ø§Ù„Øº", "t": "Ù†ÙˆØ¬ÙˆØ§Ù†",
            "e": "Ù‡Ù…Ù‡", "e10+": "Ù‡Ù…Ù‡ Û±Û°+"
        };

        // Function to set the theme
        function setTheme(isDark) {
            if (isDark) {
                document.documentElement.classList.add('dark');
                document.documentElement.classList.remove('light');
                themeToggle.textContent = 'â˜€ï¸'; // Sun icon for light mode toggle
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.add('light');
                document.documentElement.classList.remove('dark');
                themeToggle.textContent = 'ğŸŒ™'; // Moon icon for dark mode toggle
                localStorage.setItem('theme', 'light');
            }
        }

        // Initialize theme based on local storage or Tehran time
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                setTheme(savedTheme === 'dark');
            } else {
                // Determine theme based on Tehran time
                const now = new Date();
                const tehranTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Tehran' }));
                const hour = tehranTime.getHours();
                // Assume day from 6 AM to 6 PM (18:00)
                const isDayTimeInTehran = hour >= 6 && hour < 18;
                setTheme(!isDayTimeInTehran); // Default to dark if it's night in Tehran
            }
        }

        // Function to apply column layout and sizing
        function applyColumnLayout(columns) {
            // Remove existing layout-cols classes from gamesContainer
            gamesContainer.classList.remove('layout-cols-1', 'layout-cols-2', 'layout-cols-3', 'layout-cols-4');
            // Add the new layout-cols class to gamesContainer
            gamesContainer.classList.add(`layout-cols-${columns}`);

            // Save preference to local storage
            localStorage.setItem('selectedColumns', columns);
            applyFilter(); // Re-render to apply new sizing
        }

        // Function to render games based on filter
        function renderGames(gamesToRender) {
            gamesContainer.innerHTML = ''; // Clear existing games
            if (gamesToRender.length === 0) {
                noGamesMessage.classList.remove('hidden');
                return;
            } else {
                noGamesMessage.classList.add('hidden');
            }

            gamesToRender.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card bg-gray-700 rounded-xl shadow-lg overflow-hidden flex flex-col transform hover:scale-105 transition duration-300 ease-in-out';

                // Placeholder image if image_url is missing or broken
                const imageUrl = game.image_url || `https://placehold.co/600x338/374151/D1D5DB?text=${encodeURIComponent(game.title || 'ØªØµÙˆÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª').replace(/'/g, "%27")}`;
                
                // Use persian_summary if available, otherwise description, and clean it
                const rawDescription = game.persian_summary || game.description || 'ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.';
                const cleanedDescription = cleanText(rawDescription);
                const displaySummary = cleanedDescription.length > 150 ? cleanedDescription.substring(0, 150) + '...' : cleanedDescription;


                let storeInfoHtml = '';
                let buttonHtml = ''; // For the "Get Game" or "View Discount" button

                // Determine store display name
                let displayStoreName = game.store ? game.store.toLowerCase() : '';
                if (displayStoreName === 'google play' || displayStoreName === 'epic games (android)') {
                    displayStoreName = 'android';
                } else if (displayStoreName === 'ios app store' || displayStoreName === 'epic games (ios)') {
                    displayStoreName = 'ios';
                }
                // Normalize for map lookup (remove spaces)
                displayStoreName = storeDisplayMap[displayStoreName.replace(/\s/g, '')] || game.store; // Get Persian name

                let dlcOrAddonTag = '';
                if (game.is_dlc_or_addon) {
                    dlcOrAddonTag = `<span class="bg-purple-600 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full mr-2">DLC/Ø§ÙØ²ÙˆÙ†Ù‡</span>`;
                }

                if (game.is_free === false) { // If it's a discounted item
                    const normalizedStoreForDisplay = game.store ? game.store.toLowerCase().replace(/\s/g, '') : '';
                    const originalStoreDisplay = storeDisplayMap[normalizedStoreForDisplay] || game.store;
                    storeInfoHtml = `<p class="text-gray-400 mb-2">${dlcOrAddonTag}<span class="font-medium text-red-400">ØªØ®ÙÛŒÙâ€ŒØ®ÙˆØ±Ø¯Ù‡</span> Ø§Ø² <span class="font-medium text-purple-300">${originalStoreDisplay}</span></p>`;
                    buttonHtml = `<a href="${game.url}" target="_blank" rel="noopener noreferrer" class="card-button view-discount">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ®ÙÛŒÙ</a>`;
                } else { // If it's a truly free game
                    let displayStoreNameCleaned = game.store.toLowerCase();
                    if (displayStoreNameCleaned === 'google play' || displayStoreNameCleaned === 'epic games (android)') {
                        displayStoreNameCleaned = 'android';
                    } else if (displayStoreNameCleaned === 'ios app store' || displayStoreNameCleaned === 'epic games (ios)') {
                        displayStoreNameCleaned = 'ios';
                    }
                    displayStoreNameCleaned = storeDisplayMap[displayStoreNameCleaned.replace(/\s/g, '')] || game.store;
                    storeInfoHtml = `<p class="text-gray-400 mb-2">${dlcOrAddonTag}<span class="font-medium text-purple-300">${displayStoreNameCleaned}</span></p>`;
                    buttonHtml = `<a href="${game.url}" target="_blank" rel="noopener noreferrer" class="card-button get-game">Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø§Ø²ÛŒ</a>`;
                }

                // --- Start: All requested information to display on the main card ---
                let cardInfoHtml = '';

                // Genres
                const cardDisplayGenres = (game.persian_genres && game.persian_genres.length > 0) 
                                        ? game.persian_genres.map(g => genreDisplayMap[g.toLowerCase()] || g).join(', ')
                                        : (game.genres && game.genres.length > 0 ? game.genres.map(g => genreDisplayMap[g.toLowerCase()] || g).join(', ') : '');
                if (cardDisplayGenres) {
                    cardInfoHtml += `<div class="card-info-item"><i class="fas fa-tags text-pink-400"></i> <span>Ú˜Ø§Ù†Ø±Ù‡Ø§:</span> ${cardDisplayGenres}</div>`;
                }

                // Age Rating
                const cardDisplayAgeRating = (game.persian_age_rating && ageRatingDisplayMap[game.persian_age_rating.toLowerCase()]) 
                                             ? ageRatingDisplayMap[game.persian_age_rating.toLowerCase()] 
                                             : (game.age_rating && ageRatingDisplayMap[game.age_rating.toLowerCase()] ? ageRatingDisplayMap[game.age_rating.toLowerCase()] : game.age_rating || '');
                if (cardDisplayAgeRating) {
                    cardInfoHtml += `<div class="card-info-item"><i class="fas fa-child text-orange-400"></i> <span>Ø±Ø¯Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø³Ù†ÛŒ:</span> ${cardDisplayAgeRating}</div>`;
                }

                // Player Info (Single/Multiplayer, Online/Offline)
                let cardPlayerInfo = '';
                if (game.is_multiplayer && game.is_online) {
                    cardPlayerInfo = `Ú†Ù†Ø¯Ù†ÙØ±Ù‡ (Ø¢Ù†Ù„Ø§ÛŒÙ†)`;
                } else if (game.is_multiplayer) {
                    cardPlayerInfo = `Ú†Ù†Ø¯Ù†ÙØ±Ù‡ (Ø¢ÙÙ„Ø§ÛŒÙ†)`;
                } else if (game.is_online) {
                    cardPlayerInfo = `ØªÚ©â€ŒÙ†ÙØ±Ù‡ (Ø¢Ù†Ù„Ø§ÛŒÙ†)`;
                } else {
                    cardPlayerInfo = `ØªÚ©â€ŒÙ†ÙØ±Ù‡`;
                }
                cardInfoHtml += `<div class="card-info-item"><i class="fas fa-users text-cyan-400"></i> <span>ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†:</span> ${cardPlayerInfo}</div>`;


                // Metacritic Scores (Critic and User)
                if (game.metacritic_score) {
                    cardInfoHtml += `<div class="card-info-item"><i class="fas fa-star text-yellow-400"></i> <span>Ù…ØªØ§Ú©Ø±ÛŒØªÛŒÚ© (Ù…Ù†ØªÙ‚Ø¯Ø§Ù†):</span> ${game.metacritic_score}/100</div>`;
                }
                if (game.metacritic_userscore) {
                    cardInfoHtml += `<div class="card-info-item"><i class="fas fa-users text-green-400"></i> <span>Ù…ØªØ§Ú©Ø±ÛŒØªÛŒÚ© (Ú©Ø§Ø±Ø¨Ø±Ø§Ù†):</span> ${game.metacritic_userscore}/10</div>`;
                }

                // Steam Scores (Overall and Recent)
                if (game.steam_overall_score) {
                    cardInfoHtml += `<div class="card-info-item"><i class="fab fa-steam text-blue-400"></i> <span>Ø§Ø³ØªÛŒÙ… (Ú©Ù„ÛŒ):</span> ${game.steam_overall_score}% (${game.steam_overall_reviews_count || 0} Ø±Ø§ÛŒ)</div>`;
                }
                if (game.steam_recent_score) {
                    cardInfoHtml += `<div class="card-info-item"><i class="fab fa-steam-square text-blue-300"></i> <span>Ø§Ø³ØªÛŒÙ… (Ø§Ø®ÛŒØ±):</span> ${game.steam_recent_score}% (${game.steam_recent_reviews_count || 0} Ø±Ø§ÛŒ)</div>`;
                }
                // --- End: All requested information to display on the main card ---
                
                gameCard.innerHTML = `
                    <img src="${imageUrl}" alt="${game.title}" class="w-full object-cover rounded-t-xl" onerror="this.onerror=null;this.src='https://placehold.co/600x338/374151/D1D5DB?text=${encodeURIComponent(game.title || 'ØªØµÙˆÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª').replace(/'/g, "%27")}';">
                    <div class="p-4 flex flex-col flex-grow">
                        <h2 class="text-xl font-semibold text-white mb-2">${game.title}</h2>
                        ${storeInfoHtml}
                        <div class="card-info-grid">
                            ${cardInfoHtml}
                        </div>
                        <p class="description-summary text-gray-300 text-sm">
                            ${displaySummary}
                        </p>
                        ${buttonHtml}
                        ${game.trailer ? `<a href="${game.trailer}" target="_blank" rel="noopener noreferrer" class="card-button trailer">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ±ÛŒÙ„Ø±</a>` : ''}
                    </div>
                `;
                gamesContainer.appendChild(gameCard);
            });
            // Removed event listener for "Show Details" button as modal is removed
        }

        // Removed modal-related functions and elements
        // const modal = document.getElementById('game-details-modal'); // Removed
        // const closeButton = modal.querySelector('.close-button'); // Removed
        // ... (all other modal related constants and functions)

        // Function to apply filters and re-render games
        function applyFilter() {
            const selectedStore = storeFilter.value;
            const selectedContentType = contentTypeFilter.value;
            const selectedPriceType = priceTypeFilter.value;

            let filteredGames = allGames.filter(game => {
                // Store filter
                let gameStoreNormalized = game.store ? game.store.toLowerCase() : '';
                if (gameStoreNormalized === 'google play' || gameStoreNormalized === 'epic games (android)') {
                    gameStoreNormalized = 'android';
                } else if (gameStoreNormalized === 'ios app store' || gameStoreNormalized === 'epic games (ios)') {
                    gameStoreNormalized = 'ios';
                }
                const gameStorePersian = storeDisplayMap[gameStoreNormalized.replace(/\s/g, '')] || game.store;
                const isStoreMatch = selectedStore === 'all' || (gameStorePersian && gameStorePersian.toLowerCase() === selectedStore.toLowerCase());
                if (!isStoreMatch) return false;

                // Content type filter (games vs. DLC/Addon)
                const isDLC = game.is_dlc_or_addon || false;
                if (selectedContentType === 'games-only' && isDLC) return false;
                if (selectedContentType === 'dlc-only' && !isDLC) return false;

                // Price type filter (free vs. discounted)
                const isFree = game.is_free;
                if (selectedPriceType === 'free-only' && !isFree) return false;
                if (selectedPriceType === 'discounted-only' && isFree) return false;

                return true;
            });
            renderGames(filteredGames);
        }

        // Populate store filter options
        function populateStoreFilter(games) {
            const uniqueStores = new Set();
            games.forEach(game => {
                if (game.store) {
                    let normalizedStore = game.store.toLowerCase();
                    if (normalizedStore === 'google play' || normalizedStore === 'epic games (android)') {
                        normalizedStore = 'android';
                    } else if (normalizedStore === 'ios app store' || normalizedStore === 'epic games (ios)') {
                        normalizedStore = 'ios';
                    }
                    uniqueStores.add(normalizedStore.replace(/\s/g, ''));
                }
            });

            let sortedStores = Array.from(uniqueStores)
                .map(storeKey => storeDisplayMap[storeKey] || storeKey)
                .sort((a, b) => {
                    const indexA = storeDisplayOrder.indexOf(a);
                    const indexB = storeDisplayOrder.indexOf(b);
                    return indexA - indexB;
                });

            storeFilter.innerHTML = '<option value="all">Ù‡Ù…Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§</option>';
            sortedStores.forEach(storeName => {
                const option = document.createElement('option');
                option.value = storeName;
                option.textContent = storeName;
                storeFilter.appendChild(option);
            });
        }


        // Fetch games data
        async function fetchGames() {
            loadingMessage.classList.remove('hidden');
            errorMessage.classList.add('hidden');
            noGamesMessage.classList.add('hidden');
            try {
                const response = await fetch('web_data/free_games.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allGames = await response.json();
                
                // Assign a unique ID to each game for easy lookup
                allGames.forEach((game, index) => {
                    game.id_in_db = game.id_in_db || `game-${index}`; // Use existing or generate a fallback
                });

                // Sort games: free first, then by store, then by title
                allGames.sort((a, b) => {
                    // Primary sort: is_free (true first)
                    if (a.is_free && !b.is_free) return -1;
                    if (!a.is_free && b.is_free) return 1;

                    // Secondary sort: store (alphabetical)
                    const storeA = a.store ? a.store.toLowerCase() : '';
                    const storeB = b.store ? b.store.toLowerCase() : '';
                    if (storeA < storeB) return -1;
                    if (storeA > storeB) return 1;

                    // Tertiary sort: title (alphabetical)
                    const titleA = a.title ? a.title.toLowerCase() : '';
                    const titleB = b.title ? b.title.toLowerCase() : '';
                    if (titleA < titleB) return -1;
                    if (titleA > titleB) return 1;
                    return 0;
                });

                populateStoreFilter(allGames);
                applyFilter(); // Render filtered games
            } catch (error) {
                console.error('Error fetching games:', error);
                errorMessage.classList.remove('hidden');
                gamesContainer.innerHTML = ''; // Clear any loading artifacts
            } finally {
                loadingMessage.classList.add('hidden');
            }
        }

        // Event Listeners
        storeFilter.addEventListener('change', applyFilter);
        contentTypeFilter.addEventListener('change', applyFilter);
        priceTypeFilter.addEventListener('change', applyFilter);
        columnSelector.addEventListener('change', (event) => {
            applyColumnLayout(event.target.value);
        });

        themeToggle.addEventListener('click', () => {
            setTheme(!document.documentElement.classList.contains('dark'));
        });

        // Removed modal close events
        // closeButton.addEventListener('click', closeModal); // Removed
        // modal.addEventListener('click', (event) => { ... }); // Removed
        // document.addEventListener('keydown', (event) => { ... }); // Removed

        // Scroll button logic
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) { // Show after scrolling down 300px
                scrollToTopBtn.classList.add('show');
            } else {
                scrollToTopBtn.classList.remove('show');
            }

            if ((window.innerHeight + window.scrollY) < document.body.offsetHeight - 300) { // Show if not near bottom
                scrollToBottomBtn.classList.add('show');
            } else {
                scrollToBottomBtn.classList.remove('show');
            }
        });

        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        scrollToBottomBtn.addEventListener('click', () => {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        });

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            initializeTheme();
            const savedColumns = localStorage.getItem('selectedColumns');
            if (savedColumns) {
                columnSelector.value = savedColumns;
            } else {
                // Default to 3 columns if no preference saved
                columnSelector.value = '3';
            }
            applyColumnLayout(columnSelector.value); // Apply initial layout
            fetchGames();
        });
    </script>
</body>
</html>
