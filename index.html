<!DOCTYPE html>
<html lang="fa" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø±Ø§ÛŒÚ¯Ø§Ù†</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vazirmatn Font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            direction: rtl; /* Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ */
            text-align: right; /* ØªØ±Ø§Ø² Ù…ØªÙ† Ø¨Ù‡ Ø±Ø§Ø³Øª */
        }
        /* Dark Mode Styles (default) */
        .dark {
            background: linear-gradient(to bottom right, #1a202c, #2d3748); /* Darker gradient */
            color: #e2e8f0; /* Light text */
        }
        .dark .bg-gray-700 {
            background-color: #4a5568; /* Darker card background */
        }
        .dark .text-gray-400 {
            color: #a0aec0;
        }
        .dark .text-gray-300 {
            color: #cbd5e0;
        }
        .dark .border-gray-600 {
            border-color: #4a5568;
        }
        .dark .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }

        /* Light Mode Styles */
        html.light {
            background: linear-gradient(to bottom right, #f7fafc, #edf2f7); /* Lighter gradient */
            color: #2d3748; /* Dark text */
        }
        html.light .bg-gray-700 {
            background-color: #ffffff; /* White card background */
            border: 1px solid #e2e8f0;
        }
        html.light .text-gray-400 {
            color: #4a5568;
        }
        html.light .text-gray-300 {
            color: #2d3748;
        }
        html.light .border-gray-600 {
            border-color: #e2e8f0;
        }
        html.light .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        html.light .text-white {
            color: #1a202c;
        }
        html.light .bg-clip-text {
            background-image: linear-gradient(to right, #007bff, #6f42c1); /* Adjust gradient for light mode */
        }

        /* Common card styles */
        .game-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            display: flex; /* Ensures content fills height */
            flex-direction: column; /* Stacks content vertically */
        }
        .game-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        .game-card img {
            object-fit: cover; /* Ensures images cover the area without distortion */
            height: 192px; /* Fixed height for consistency (h-48) */
        }
        .game-card .p-4 {
            flex-grow: 1; /* Allows content area to expand */
            display: flex;
            flex-direction: column;
        }
        .game-card .text-sm.mb-4.flex-grow {
            flex-grow: 1;
            overflow: hidden; /* Hide overflow text */
            display: -webkit-box;
            -webkit-line-clamp: 4; /* Limit to 4 lines */
            -webkit-box-orient: vertical;
            text-overflow: ellipsis; /* Add ellipsis for clamped text */
        }
        /* Custom styles for the theme toggle button */
        #theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .dark #theme-toggle {
            background-color: #4a5568;
            color: #f7fafc;
        }
        html.light #theme-toggle {
            background-color: #fff;
            color: #2d3748;
        }
        #theme-toggle:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-gray-100 min-h-screen p-4 sm:p-8">
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" class="bg-gray-700 text-white rounded-full p-2">
        â˜€ï¸
    </button>

    <div class="container mx-auto max-w-7xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-white mb-4">
                <span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-600">
                    Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ù…Ø±ÙˆØ²
                </span>
            </h1>
            <p class="text-lg sm:text-xl text-gray-300">
                Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ø² ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯!
            </p>
        </header>

        <!-- Store Filter -->
        <div class="mb-8 flex flex-col sm:flex-row items-center justify-center gap-4">
            <label for="store-filter" class="text-lg font-medium text-gray-300 whitespace-nowrap">
                ÙÛŒÙ„ØªØ± Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ±ÙˆØ´Ú¯Ø§Ù‡:
            </label>
            <select id="store-filter" class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-blue-500 focus:border-blue-500 w-full sm:w-auto">
                <option value="all">Ù‡Ù…Ù‡ ÙØ±ÙˆØ´Ú¯Ø§Ù‡â€ŒÙ‡Ø§</option>
                <!-- Options will be populated by JavaScript -->
            </select>
        </div>

        <div id="loading" class="text-center text-xl text-blue-400 mb-8">
            Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§...
        </div>

        <div id="error-message" class="hidden text-center text-xl text-red-400 mb-8">
            Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§. Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.
        </div>

        <div id="no-games-message" class="hidden text-center text-xl text-gray-400 mb-8">
            Ø¯Ø± Ø­Ø§Ù„ Ø­Ø§Ø¶Ø± Ù‡ÛŒÚ† Ø¨Ø§Ø²ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.
        </div>

        <div id="games-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Game cards will be injected here by JavaScript -->
        </div>
    </div>

    <script>
        let allGames = []; // To store all fetched games
        const gamesContainer = document.getElementById('games-container');
        const loadingMessage = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');
        const noGamesMessage = document.getElementById('no-games-message');
        const storeFilter = document.getElementById('store-filter');
        const themeToggle = document.getElementById('theme-toggle');

        // Function to set the theme
        function setTheme(isDark) {
            if (isDark) {
                document.documentElement.classList.add('dark');
                document.documentElement.classList.remove('light');
                themeToggle.textContent = 'â˜€ï¸'; // Sun icon for light mode toggle
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.add('light');
                document.documentElement.classList.remove('dark');
                themeToggle.textContent = 'ğŸŒ™'; // Moon icon for dark mode toggle
                localStorage.setItem('theme', 'light');
            }
        }

        // Initialize theme based on local storage or Tehran time
        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                setTheme(savedTheme === 'dark');
            } else {
                // Determine theme based on Tehran time
                const now = new Date();
                const tehranTime = new Date(now.toLocaleString('en-US', { timeZone: 'Asia/Tehran' }));
                const hour = tehranTime.getHours();
                // Assume day from 6 AM to 6 PM (18:00)
                const isDayTimeInTehran = hour >= 6 && hour < 18;
                setTheme(!isDayTimeInTehran); // Default to dark if it's night in Tehran
            }
        }

        // Function to render games based on filter
        function renderGames(gamesToRender) {
            gamesContainer.innerHTML = ''; // Clear existing games
            if (gamesToRender.length === 0) {
                noGamesMessage.classList.remove('hidden');
                return;
            } else {
                noGamesMessage.classList.add('hidden');
            }

            gamesToRender.forEach(game => {
                const gameCard = document.createElement('div');
                gameCard.className = 'game-card bg-gray-700 rounded-xl shadow-lg overflow-hidden flex flex-col transform hover:scale-105 transition duration-300 ease-in-out';

                // Placeholder image if image_url is missing or broken
                const imageUrl = game.image_url || `https://placehold.co/600x338/374151/D1D5DB?text=${encodeURIComponent(game.title || 'ØªØµÙˆÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª')}`;

                // Format scores and genres
                const metacriticScore = game.metacritic_score ? `<p class="text-sm text-gray-300"><i class="fas fa-star text-yellow-400"></i> <span class="font-semibold">Ù…ØªØ§Ú©Ø±ÛŒØªÛŒÚ©:</span> ${game.metacritic_score}/100</p>` : '';
                const metacriticUserScore = game.metacritic_userscore ? `<p class="text-sm text-gray-300"><i class="fas fa-users text-green-400"></i> <span class="font-semibold">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ØªØ§Ú©Ø±ÛŒØªÛŒÚ©:</span> ${game.metacritic_userscore}/10</p>` : '';
                const steamScore = game.steam_score ? `<p class="text-sm text-gray-300"><i class="fab fa-steam text-blue-400"></i> <span class="font-semibold">Ø§Ø³ØªÛŒÙ…:</span> ${game.steam_score}% (${game.steam_reviews_count || 0} Ø±Ø§ÛŒ)</p>` : '';
                const genres = game.genres && game.genres.length > 0 ? `<p class="text-sm text-gray-300"><i class="fas fa-tags text-pink-400"></i> <span class="font-semibold">Ú˜Ø§Ù†Ø±Ù‡Ø§:</span> ${game.genres.join(', ')}</p>` : '';
                const trailerLink = game.trailer ? `<a href="${game.trailer}" target="_blank" class="text-blue-400 hover:underline text-sm mt-2 block"><i class="fas fa-film"></i> Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªØ±ÛŒÙ„Ø±</a>` : '';

                let playerInfo = '';
                if (game.is_multiplayer && game.is_online) {
                    playerInfo = `<p class="text-sm text-gray-300"><i class="fas fa-users-line text-cyan-400"></i> <span class="font-semibold">ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†:</span> Ú†Ù†Ø¯Ù†ÙØ±Ù‡ (Ø¢Ù†Ù„Ø§ÛŒÙ†)</p>`;
                } else if (game.is_multiplayer) {
                    playerInfo = `<p class="text-sm text-gray-300"><i class="fas fa-users text-cyan-400"></i> <span class="font-semibold">ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†:</span> Ú†Ù†Ø¯Ù†ÙØ±Ù‡ (Ø¢ÙÙ„Ø§ÛŒÙ†)</p>`;
                } else if (game.is_online) {
                    playerInfo = `<p class="text-sm text-gray-300"><i class="fas fa-globe text-cyan-400"></i> <span class="font-semibold">ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†:</span> ØªÚ©â€ŒÙ†ÙØ±Ù‡ (Ø¢Ù†Ù„Ø§ÛŒÙ†)</p>`;
                } else {
                    playerInfo = `<p class="text-sm text-gray-300"><i class="fas fa-user text-cyan-400"></i> <span class="font-semibold">ØªØ¹Ø¯Ø§Ø¯ Ø¨Ø§Ø²ÛŒÚ©Ù†:</span> ØªÚ©â€ŒÙ†ÙØ±Ù‡</p>`;
                }

                // Use persian_summary if available, otherwise description
                const displayDescription = game.persian_summary || game.description || 'ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.';

                gameCard.innerHTML = `
                    <img src="${imageUrl}" alt="${game.title || 'ØªØµÙˆÛŒØ± Ø¨Ø§Ø²ÛŒ'}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x338/374151/D1D5DB?text=${encodeURIComponent(game.title || 'ØªØµÙˆÛŒØ± Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª')}';">
                    <div class="p-4 flex flex-col flex-grow">
                        <h2 class="text-xl font-bold text-white mb-2">${game.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h2>
                        <p class="text-gray-400 text-sm mb-3">ÙØ±ÙˆØ´Ú¯Ø§Ù‡: <span class="font-medium text-purple-300">${game.store || 'Ù†Ø§Ù…Ø´Ø®Øµ'}</span></p>
                        <p class="text-gray-300 text-sm mb-4 flex-grow">${displayDescription}</p>
                        <div class="mt-auto pt-3 border-t border-gray-600 space-y-1">
                            ${metacriticScore}
                            ${metacriticUserScore}
                            ${steamScore}
                            ${genres}
                            ${playerInfo}
                            ${trailerLink}
                            <a href="${game.url}" target="_blank" class="mt-4 block w-full text-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø§Ø²ÛŒ
                            </a>
                        </div>
                    </div>
                `;
                gamesContainer.appendChild(gameCard);
            });
        }

        // Function to apply filter
        function applyFilter() {
            const selectedStore = storeFilter.value;
            const filteredGames = allGames.filter(game => {
                const gameStoreNormalized = game.store ? game.store.toLowerCase().replace(/\s/g, '') : '';
                const selectedStoreNormalized = selectedStore.toLowerCase().replace(/\s/g, '');
                return selectedStore === 'all' || gameStoreNormalized === selectedStoreNormalized;
            });
            renderGames(filteredGames);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            initializeTheme(); // Set initial theme

            // Event listener for theme toggle
            themeToggle.addEventListener('click', () => {
                const isDark = document.documentElement.classList.contains('dark');
                setTheme(!isDark);
            });

            try {
                const response = await fetch('web_data/free_games.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                allGames = await response.json(); // Store all games globally

                loadingMessage.classList.add('hidden'); // Hide loading message

                if (allGames.length === 0) {
                    noGamesMessage.classList.remove('hidden'); // Show no games message
                    return;
                }

                // Populate store filter options
                const uniqueStores = [...new Set(allGames.map(game => game.store))].sort();
                uniqueStores.forEach(store => {
                    if (store && store !== 'Ù†Ø§Ù…Ø´Ø®Øµ') {
                        const option = document.createElement('option');
                        option.value = store.toLowerCase().replace(/\s/g, '');
                        option.textContent = store;
                        storeFilter.appendChild(option);
                    }
                });

                // Initial render of all games
                renderGames(allGames);

                // Event listener for store filter change
                storeFilter.addEventListener('change', applyFilter);

            } catch (error) {
                console.error('Error fetching games:', error);
                loadingMessage.classList.add('hidden');
                errorMessage.classList.remove('hidden'); // Show error message
            }
        });
    </script>
</body>
</html>
